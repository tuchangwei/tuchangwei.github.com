<!doctype html>



  


<html class="theme-next muse use-motion">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="iOS Development, iPhone Development, Android Development, API Development">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1">






<meta name="description" content="I develop iOS/Android apps with Swift/Kotlin language.">
<meta property="og:type" content="website">
<meta property="og:title" content="Changwei&#39;s Blog">
<meta property="og:url" content="http://tuchangwei.github.com/index.html">
<meta property="og:site_name" content="Changwei&#39;s Blog">
<meta property="og:description" content="I develop iOS/Android apps with Swift/Kotlin language.">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Changwei&#39;s Blog">
<meta name="twitter:description" content="I develop iOS/Android apps with Swift/Kotlin language.">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://tuchangwei.github.com/">

  <title> Changwei's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Changwei's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">I develop iOS/Android apps with Swift/Kotlin language.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/aboutme" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/03/24/Vapor4-0å†™ä¸€äº›æµ‹è¯•/" itemprop="url">
                  Vapor4.0å†™ä¸€äº›æµ‹è¯•
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2020-03-24T13:21:52+08:00" content="Mar 24 2020">
              Mar 24 2020
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Vapor4-0/" itemprop="url" rel="index">
                    <span itemprop="name">Vapor4.0</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æ²¡æœ‰æ–‡æ¡£çš„æƒ…å†µä¸‹ï¼Œä¸€åˆ‡éƒ½é æ‘¸ç´¢ã€‚åˆšå¼€å§‹çš„æ—¶å€™éƒ½ä¸çŸ¥é“æ€ä¹ˆä¸‹æ‰‹ï¼Œçœ‹çœ‹Vaporçš„æµ‹è¯•æ€ä¹ˆå†™ï¼Œçœ‹çœ‹Fluentçš„æµ‹è¯•æ€ä¹ˆå†™ã€‚ä¸‡äº‹å¼€å¤´éš¾ï¼Œæ€»ç®—æ‘¸å‡ºä¸ªå¤´ç»ªã€‚</p>
<p>é¦–å…ˆï¼Œè¦é…ç½®æµ‹è¯•ç¯å¢ƒ, åœ¨Xcodeä¸­çš„é…ç½®å¦‚ä¸‹ã€‚<br><img src="/2020/03/24/Vapor4-0å†™ä¸€äº›æµ‹è¯•/WX20200324-134857.png"><br>ç„¶åæ–°å»ºæµ‹è¯•æ•°æ®åº“ã€‚<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> --name postgres-test -e <span class="attribute">POSTGRES_DB</span>=test \</span><br><span class="line">-e <span class="attribute">POSTGRES_USER</span>=test -e <span class="attribute">POSTGRES_PASSWORD</span>=test \</span><br><span class="line">-p 5433:5432 -d postgres</span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯•ä¸€ä¸‹:<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testDatabaseConfig</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> app = <span class="type">Application</span>(.testing)</span><br><span class="line">    <span class="keyword">defer</span> &#123; app.shutdown() &#125;</span><br><span class="line">    <span class="keyword">try</span> configure(app)</span><br><span class="line">    <span class="type">XCTAssertTrue</span>(<span class="type">Int</span>(<span class="type">Environment</span>.<span class="keyword">get</span>(<span class="string">"DATABASE_PORT"</span>) ?? <span class="string">"5432"</span>)! == <span class="number">5433</span>, <span class="string">"DATABASE_PORT is wrong"</span>)</span><br><span class="line">    <span class="type">XCTAssertTrue</span>(<span class="type">Environment</span>.<span class="keyword">get</span>(<span class="string">"DATABASE_USERNAME"</span>) == <span class="string">"test"</span>, <span class="string">"DATABASE_USERNAME is wrong"</span>)</span><br><span class="line">    <span class="type">XCTAssertTrue</span>(<span class="type">Environment</span>.<span class="keyword">get</span>(<span class="string">"DATABASE_PASSWORD"</span>) == <span class="string">"test"</span>, <span class="string">"DATABASE_PASSWORD is wrong"</span>)</span><br><span class="line">    <span class="type">XCTAssertTrue</span>(<span class="type">Environment</span>.<span class="keyword">get</span>(<span class="string">"DATABASE_NAME"</span>) == <span class="string">"test"</span>, <span class="string">"DATABASE_PASSWORD is wrong"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯•æ–°å»ºè¡¨æ ¼æ˜¯å¦æˆåŠŸ:<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">func testArticleTable() throws &#123;</span><br><span class="line">    let app = Application(.testing)</span><br><span class="line">    defer &#123; app.shutdown() &#125;</span><br><span class="line">    <span class="keyword">try</span> configure(app)</span><br><span class="line">    let article = Article(<span class="built_in">name</span>: <span class="string">"title"</span>, body: <span class="string">"body"</span>, categoryID: nil)</span><br><span class="line">    <span class="keyword">try</span> article.save(<span class="keyword">on</span>: app.db).wait()</span><br><span class="line">    let articles = <span class="keyword">try</span> Article.query(<span class="keyword">on</span>: app.db).all().wait()</span><br><span class="line">    XCTAssertEqual(articles.<span class="built_in">count</span>, <span class="number">1</span>)</span><br><span class="line">    XCTAssertEqual(articles.<span class="keyword">first</span>?.<span class="built_in">name</span>, <span class="string">"title"</span>)</span><br><span class="line">    XCTAssertEqual(articles.<span class="keyword">first</span>?.body, <span class="string">"body"</span>)</span><br><span class="line">    XCTAssertNil(articles.<span class="keyword">first</span>?.category)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­åœ¨<code>configure.swift</code>æ–‡ä»¶ä¸­åŠ å…¥ä¸€äº›è¾…åŠ©æ–¹æ³•è°ƒç”¨ï¼Œä½¿æµ‹è¯•ä¹‹å‰æ¸…ç©ºæ•°æ®åº“ã€‚<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public func configure(_ <span class="keyword">app</span>: Application) throws &#123;</span><br><span class="line">    <span class="comment">// uncomment to serve files from /Public folder</span></span><br><span class="line">    <span class="keyword">app</span>.middleware.<span class="keyword">use</span>(FileMiddleware(publicDirectory: <span class="keyword">app</span>.directory.publicDirectory))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">app</span>.databases.<span class="keyword">use</span>(.postgres(</span><br><span class="line">        hostname: Environment.<span class="built_in">get</span>(<span class="string">"DATABASE_HOST"</span>) ?? <span class="string">"localhost"</span>,</span><br><span class="line">        port: Int(Environment.<span class="built_in">get</span>(<span class="string">"DATABASE_PORT"</span>) ?? <span class="string">"5432"</span>) ?? 5432,</span><br><span class="line">        username: Environment.<span class="built_in">get</span>(<span class="string">"DATABASE_USERNAME"</span>) ?? <span class="string">"vapor_username"</span>,</span><br><span class="line">        password: Environment.<span class="built_in">get</span>(<span class="string">"DATABASE_PASSWORD"</span>) ?? <span class="string">"vapor_password"</span>,</span><br><span class="line">        database: Environment.<span class="built_in">get</span>(<span class="string">"DATABASE_NAME"</span>) ?? <span class="string">"vapor_database"</span></span><br><span class="line">    ), <span class="keyword">as</span>: .psql)</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">app</span>.migrations.add(CreateArticleGategory())</span><br><span class="line">    <span class="keyword">app</span>.migrations.add(CreateArticle())</span><br><span class="line">    <span class="comment">//&lt;==å¦‚æœæ˜¯æµ‹è¯•ç¯å¢ƒï¼Œåˆ™æ¸…ç©ºæ•°æ®åº“ã€‚æ³¨æ„è¿™ä¸‰è¡Œä»£ç çš„ä½ç½®è¦æ”¾åœ¨addæ–¹æ³•ä¹‹ä¸‹çš„ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">app</span>.environment == .testing &#123;</span><br><span class="line">        try <span class="keyword">app</span>.autoRevert().wait()</span><br><span class="line">        try <span class="keyword">app</span>.autoMigrate().wait()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¼€å¯é¡µé¢æ¸²æŸ“</span></span><br><span class="line">    <span class="keyword">app</span>.views.<span class="keyword">use</span>(.leaf)</span><br><span class="line">    <span class="keyword">app</span>.leaf.cache.isEnabled = false</span><br><span class="line">    <span class="comment">// register routes</span></span><br><span class="line">    try routes(<span class="keyword">app</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/03/20/Vapor4-0åŠ å…¥æ•°æ®åº“/" itemprop="url">
                  Vapor4.0åŠ å…¥æ•°æ®åº“
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2020-03-20T16:01:06+08:00" content="Mar 20 2020">
              Mar 20 2020
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä»Šå¤©ä¸»è¦æ˜¯æ“ä½œpostgresæ•°æ®åº“ï¼ŒéªŒè¯è¡¨å…³ç³»ï¼Œä¸»è¦æµ‹è¯•è”æœºåˆ é™¤å’Œå¤–é”®ä¸ºç©ºçš„æƒ…å†µã€‚</p>
<p>æ•°æ®åº“ä¸­å»ºäº†æ–‡ç« è¡¨(å­è¡¨)å’Œç±»åˆ«è¡¨(çˆ¶è¡¨)ï¼Œç±»åˆ«è¡¨çš„ä¸»é”®æ˜¯æ–‡ç« è¡¨çš„å¤–é”®ï¼Œæ–‡ç« è¡¨çš„å¤–é”®çº¦æŸæ˜¯è”æœºåˆ é™¤ï¼Œå®ƒçš„æ„æ€æ˜¯å½“åˆ é™¤ç±»åˆ«è¡¨çš„æŸé¡¹è®°å½•æ—¶ï¼Œæ–‡ç« è¡¨é‡Œå’Œæ­¤ç±»åˆ«è®°å½•æœ‰å…³çš„è®°å½•éƒ½ä¼šè¢«åˆ é™¤ã€‚é€»è¾‘å¥½ç»•ã€‚</p>
<p>è®¿é—®postgresæ•°æ®åº“æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯å…ˆè¿›å…¥å®¹å™¨ï¼Œç„¶åè®¿é—®ã€‚è¿›å…¥å®¹å™¨æˆ‘ç”¨çš„æ˜¯Codeçš„Dockeræ’ä»¶è¿›å…¥çš„ã€‚è¿›å»ä¹‹åè¾“å…¥ç”¨æˆ·åå’Œæ•°æ®åº“åå°±è¿›å»äº†ã€‚</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">psql</span> -U vapor_username -d vapor_database</span><br></pre></td></tr></table></figure>
<p>å¦ä¸€ç§æ–¹å¼æ˜¯ç”¨Terminalè®¿é—®ï¼Œä¹Ÿå°±æ˜¯ä»å®¹å™¨å¤–è®¿é—®ã€‚é¦–å…ˆå®‰è£…postgresåˆ°æœ¬åœ°ã€‚<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>postgresql</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åå‘½ä»¤:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -U vapor_username -d vapor_database -h localhost -<span class="selector-tag">p</span> <span class="number">5432</span></span><br></pre></td></tr></table></figure></p>
<p>æˆ‘å› ä¸ºä»¥å‰ä¸€ç›´å¼€ç€Proxifierï¼Œå¯¼è‡´è®¿é—®5432ç«¯å£éƒ½ç»™è½¬å‘ç»™1081ç«¯å£äº†ï¼Œæ‰€ä»¥ä¸€ç›´ç™»é™†ä¸ä¸Šï¼Œçœ‹äº†Proxifierä¸­çš„æ—¥å¿—æ‰å‘ç°è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ä»å¤§å­¦æ¯•ä¸šå°±æ²¡å†™è¿‡SQLè¯­å¥äº†ï¼Œpostgresä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡ç”¨ï¼Œæµ‹è¯•å¤–é”®è´¹äº†ä¸å°‘åŠŸå¤«ã€‚å¦‚ä¸‹æ’å…¥çš„è¯­å¥ï¼Œå› ä¸ºå¿˜è®°æ‰“æœ€åé¢çš„åˆ†å·ï¼Œpsqlè¿˜åœ¨ç­‰æˆ‘è¾“å…¥ï¼Œæˆ‘åˆè¾“å…¥æŸ¥è¯¢è¯­å¥ï¼Œå•¥ä¹Ÿæ²¡æ˜¾ç¤ºï¼Œåé¢æŸ¥æŸ¥æ‰çŸ¥é“åé¢è¦å¸¦åˆ†å·ã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> articles(<span class="keyword">id</span>, <span class="keyword">name</span>, <span class="keyword">body</span>, category_id) <span class="keyword">VALUES</span>(<span class="string">'40e6215d-b5c6-4896-987c-f30f3678f604'</span>,<span class="string">'hello'</span>,<span class="string">'my name is vale'</span>,<span class="string">'40e6215d-b5c6-4896-987c-f30f3678f604'</span>);</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/03/18/Vapor4-0å¯¹docker-composeæ–‡ä»¶æµ…æ/" itemprop="url">
                  Vapor4.0å¯¹docker-Composeæ–‡ä»¶æµ…æ
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2020-03-18T10:46:20+08:00" content="Mar 18 2020">
              Mar 18 2020
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä¸Šç¯‡å¯¹<code>docker-compose.yml</code>çš„æŸäº›ç†è§£æœ‰è¯¯ï¼Œè¿™ç¯‡å¯¹æŸäº›å‘½ä»¤è¿›è¡Œæµ…è§£ã€‚<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">docker</span> <span class="keyword">build </span>-f Dockerfile -t tblog .</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¸ª<code>.</code>æ˜¯æŒ‡ä¸Šä¸‹æ–‡è·¯å¾„ï¼Œå‚è§<a href="https://yeasy.gitbooks.io/docker_practice/image/build.html" target="_blank" rel="noopener">è¿™é‡Œ</a>-<strong>é•œåƒæ„å»ºä¸Šä¸‹æ–‡(Context)</strong></p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker-compose build</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‘½ä»¤ä¸ºå•¥å…ˆå»è¿è¡Œ<code>Dockerfile</code>é‡Œçš„å‘½ä»¤å‘¢ï¼Ÿå› ä¸ºè¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨æ¥æ„å»º<code>tblog:latest</code>é•œåƒçš„ã€‚åœ¨<code>docker-compose.xml</code>ä¸­çš„é¦–è¦ä»»åŠ¡å°±æ˜¯æ„å»º<code>tblog:latest</code>ï¼Œ å¹¶æŒ‡å®šäº†buildæ‰€éœ€è¦çš„ä¸Šä¸‹æ–‡, dockerå°±æ‰¾åˆ°ä¸Šä¸‹æ–‡ä¸­çš„<code>Dockerfile</code>è¿›è¡Œç¼–è¾‘äº†ã€‚å°±æ˜¯ä¸‹é¢è¿™ä¸€æ®µã€‚<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr"> app:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="attr">tblog:latest</span></span><br><span class="line"><span class="attr">    build:</span></span><br><span class="line"><span class="attr">      context:</span> <span class="string">.</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure></p>
<p><code>docker-compose.xml</code>æœ€ä¸Šé¢æœ‰ä¸€æ®µï¼š<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">volumes:</span></span><br><span class="line"><span class="symbol">  db_data:</span></span><br><span class="line">  ....</span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªæ˜¯å¹²å˜›çš„å‘¢ï¼Ÿè¿™ä¸ªæ˜¯åˆ›å»ºä¸€ä¸ªç£ç›˜ã€‚<code>db_data:</code>åº”è¯¥å°±ç›¸å½“äºæˆ‘ä»¬è¯´çš„ç›˜ç¬¦ã€‚æ²¡æœ‰ç»™è¿™ä¸ªç›˜æŒ‡å®šåç§°ï¼Œå®ƒä¼šæœ‰ä¸ªé»˜è®¤çš„åç§°<code>tblog_db_data</code>, ä¹Ÿå¯ä»¥è¿™æ ·æŒ‡å®šç£ç›˜çš„åç§°ã€‚</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">volumes:</span></span><br><span class="line"><span class="symbol">  db_data:</span></span><br><span class="line"><span class="symbol">    name:</span> <span class="string">"tuchangwei"</span></span><br></pre></td></tr></table></figure>
<p>ç£ç›˜æ˜¯ç”¨æ¥å­˜æ•°æ®çš„ï¼Œå®ƒä¸ä¼šæ¶ˆå¤±ã€‚å¤šä¸ªå®¹å™¨ä¹Ÿå¯ä»¥å…±äº«è¿™ä¸ªç£ç›˜ã€‚æˆ‘ä»¬çš„æ•°æ®åº“å°±æŠŠæ•°æ®æ”¾åœ¨è¿™ä¸ªç£ç›˜é‡Œé¢:<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="symbol">db:</span></span><br><span class="line">    <span class="symbol">image:</span> <span class="symbol">postgres:</span><span class="number">12.1</span>-alpine</span><br><span class="line">    <span class="symbol">volumes:</span></span><br><span class="line">       - <span class="symbol">db_data:</span>/var/<span class="class"><span class="keyword">lib</span>/<span class="title">postgresql</span>/<span class="title">data</span>/<span class="title">pgdata</span></span></span><br></pre></td></tr></table></figure></p>
<p>å¯¹äº<code>docker-compose.xml</code>æ–‡ä»¶é‡Œå‘½ä»¤çš„è§£é‡Šï¼Œå¯ä»¥å‚è€ƒ<a href="https://docs.docker.com/compose/compose-file/#depends_on" target="_blank" rel="noopener">è¿™é‡Œ</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/03/15/Vapor4-0å¯¹Dockerfileæ–‡ä»¶æµ…æ/" itemprop="url">
                  Vapor4.0å¯¹Dockerfileæ–‡ä»¶æµ…æ
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2020-03-15T10:54:37+08:00" content="Mar 15 2020">
              Mar 15 2020
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Vapor4-0/" itemprop="url" rel="index">
                    <span itemprop="name">Vapor4.0</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æ˜¨å¤©å‘¨å…­ï¼Œè¢«Dockerä¸­é…ç½®Vaporæåˆ°è„‘è¢‹è¦ç‚¸ï¼Œå·®ä¸€ç‚¹æ”¾å¼ƒVaporçš„å­¦ä¹ ã€‚ä½†ä»Šå¤©æ„Ÿè§‰è¿˜å¥½ï¼Œè„‘ç‚¸æ˜¯æºäºå¯¹æœªçŸ¥çš„ææƒ§ã€‚</p>
<p>æœ¬èº«ç›¸å…³çš„åŒ…ä¾èµ–ä¸‹è½½å°±éå¸¸çš„è€—æ—¶ï¼Œç¨ä¸ªä¸æ…è¿˜è¦é‡æ–°ä¸‹è½½ï¼Œç®€ç›´å¥”æºƒã€‚</p>
<p>æˆ‘çš„æƒ³æ³•æ˜¯å…ˆå»ºä¸ªæ¨¡ç‰ˆé¡¹ç›®å‘å¸ƒä¸€ä¸‹ï¼Œç†Ÿæ‚‰æ•´ä¸ªæµç¨‹åï¼Œå°±è¾¹åŠ åŠŸèƒ½è¾¹å‘å¸ƒã€‚å› ä¸ºè¦ä¿æŒç¯å¢ƒçš„ä¸€è‡´æ€§ï¼ŒVaporç¤¾åŒºæ¯”è¾ƒæ¨èåœ¨Dockerä¸­éƒ¨ç½²ï¼Œç„¶åå†æŠŠDockeréƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œæ¨¡ç‰ˆé¡¹ç›®ä¸­ä¹Ÿæä¾›äº†ä¸¤ä¸ªDockerç›¸å…³çš„æ–‡ä»¶ <code>Dockerfile</code> å’Œ <code>docker-compose.yml</code>ã€‚ä½†æ˜¯ç½‘ç»œä¸Šå…³äºDockeréƒ¨ç½²Vapor4çš„èµ„æ–™ç®€ç›´æ˜¯æ²¡æœ‰ï¼Œçœ‹ç€ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„å‘½ä»¤å°±å¤´å¤§ã€‚è„‘ä¸­çš„é—®é¢˜ä¸€ç›´åœ¨é£ï¼š æœ¬åœ°é¡¹ç›®æ€ä¹ˆéƒ¨ç½²åˆ°Dockerå®¹å™¨ä¸­ï¼Ÿæ˜¯ä¸æ˜¯è¦å…ˆåœ¨å®¹å™¨ä¸­å®‰è£…Swiftå’ŒPostpostgres?éƒ¨ç½²çš„é¡¹ç›®å’Œpostpostrgesæ˜¯åŒä¸€ä¸ªå®¹å™¨ï¼Œè¿˜æ˜¯ä¸¤ä¸ªå®¹å™¨ï¼Ÿè¿™ä¸¤ä¸ªå®¹å™¨æ€ä¹ˆäº¤æµï¼Ÿæœ¬åœ°é¡¹ç›®åšäº†æ›´æ”¹åï¼ŒDockerä¸­çš„é¡¹ç›®ä¼šè‡ªåŠ¨æ›´æ”¹å—ï¼Ÿè¿™äº›é—®é¢˜æ€ä¹ˆç”¨å‘½ä»¤è¡Œè§£å†³ï¼Ÿè°æƒ³è°è„‘ç‚¸ã€‚</p>
<p>æ­£å½“æˆ‘è¦æ”¾å¼ƒçš„æ—¶å€™ï¼Œç¤¾åŒºçš„æ¸©æš–é€æ¥äº†ğŸ™ã€‚</p>
<blockquote>
<p>Deploying with docker is quite easy. Assuming you want to deploy a fresh Vapor 4 project:</p>
</blockquote>
<blockquote>
<p>Requirements: Install latest Xcode 11.4 Beta and switch to Swift 5.2 in the preferences. (You can check in the command line using swift â€“version) If you want to use Docker locally on your Mac, you should install Docker Desktop for Mac. </p>
</blockquote>
<blockquote>
<p>Run <code>vapor new --branch=4 myProject</code> to create a fresh project from template. (You can do any changes if you want, but the fresh template already provides a Hello World example.)</p>
</blockquote>
<blockquote>
<p>To run your application within Docker, there is already a <code>web.Dockerfile</code> provided in the template.<br>Weâ€™ll have to build an image first. Run <code>docker build -f web.Dockerfile -t my-project .</code>  Of course you can use whatever tag (my-project) you like.<br>To test your image locally use <code>docker run --rm -p 8080:80 my-project</code> (We use â€“rm to delete the container when we stop the app. The flag -p 8080:80 exposes the port 80 from within the container to port 8080 on our host.) You will see something like [ NOTICE ] Server starting on <a href="http://0.0.0.0:80" target="_blank" rel="noopener">http://0.0.0.0:80</a> in the command line. Visit <a href="http://localhost:8080/" target="_blank" rel="noopener">http://localhost:8080/</a> in your browser and you should see â€œIt works!â€ from your Vapor application.</p>
</blockquote>
<blockquote>
<p>If you make changes to your application, stop the container, build and run it again.</p>
</blockquote>
<p>æ‰€ä»¥ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡ï¼Œå…ˆåœ¨é¡¹ç›®ç›®å½•ä¸‹è¾“å…¥å¦‚ä¸‹å‘½ä»¤:</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">docker</span> <span class="keyword">build </span>-f Dockerfile -t tblog .</span><br></pre></td></tr></table></figure>
<p>é¡¹ç›®å°±å¼€å§‹åœ¨Dockerä¸­å®‰è£…äº†ã€‚æ³¨æ„å‘½ä»¤åé¢é‚£ä¸ª<code>.</code>åˆ«å¿˜äº†ï¼Œé‚£ä¸ªæ˜¯å½“å‰ç›®å½•çš„æ„æ€ã€‚</p>
<p>å®Œåæˆ‘æŒ‰ç…§ä¸Šé¢å¤§ä½¬çš„å‘½ä»¤ï¼š<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">run</span> <span class="comment">--rm -p 8080:80 tblog</span></span><br></pre></td></tr></table></figure></p>
<p>å¹¶æ²¡æœ‰æŠŠé¡¹ç›®è·‘èµ·æ¥ï¼Œè¿™é‡Œå¯ä»¥ä»ä¸¤å¤„åšä¸€ä¸‹æ›´æ”¹ã€‚ä¸€ä¸ªæ˜¯æŠŠå‘½ä»¤è¡Œæ”¹æˆï¼š<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">run</span> <span class="comment">--rm -p 8080:8080 tblog</span></span><br></pre></td></tr></table></figure></p>
<p>å› ä¸ºå¦ä¸€ä¸ªå¤§ä½¬è¯´dockeré»˜è®¤æš´éœ²çš„æ˜¯8080ç«¯å£ã€‚æˆ–è€…åœ¨<code>Dockerfile</code>æ–‡ä»¶ä¸­æŠŠæœ€åä¸€è¡Œæ”¹ä¸ºï¼š</p>
<blockquote>
<p>CMD [â€œserveâ€, â€œâ€“envâ€, â€œproductionâ€, â€œâ€“hostnameâ€, â€œ0.0.0.0â€, â€œâ€“portâ€, â€œ80â€]</p>
</blockquote>
<p>æŠŠ80ç«¯å£æš´éœ²å‡ºæ¥ã€‚</p>
<p><code>Dockerfile</code>é‡Œçš„å‘½ä»¤å¤§æ¦‚è§£é‡Šä¸€ä¸‹ï¼Œå°±æ˜¯å…ˆåœ¨Dockerå®¹å™¨é‡Œä¸‹è½½Swift5.2, ç„¶åæŠŠæœ¬åœ°çš„é¡¹ç›®æ‹·è´åˆ°å®¹å™¨é‡Œï¼Œç„¶åç¼–è¯‘ã€‚ç„¶åå†æŠŠUbuntuæ‹·è´ä¸‹æ¥ï¼ŒæŠŠç¼–è¯‘çš„æ–‡ä»¶æ”¾åœ¨Ubuntuçš„ç›®å½•ç»“æ„ä¸‹ã€‚ç„¶åè¿è¡Œã€‚</p>
<p>è¿™ä¸ªæ—¶å€™é¡¹ç›®è·‘èµ·æ¥æ˜¯æ²¡æœ‰æ•°æ®åº“çš„, <code>docker-compose.yml</code>è¿™ä¸ªæ–‡ä»¶å°±æœ‰ç”¨äº†ã€‚</p>
<p>è¿è¡Œå‘½ä»¤ï¼š<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose <span class="meta">up</span> <span class="built_in">db</span></span><br></pre></td></tr></table></figure></p>
<p>ä¼šå®‰è£…æ•°æ®åº“postgresï¼Œå¹¶å¯åŠ¨æ•°æ®åº“ã€‚</p>
<p>è¿è¡Œå‘½ä»¤ï¼š<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker-compose up migrate</span></span><br></pre></td></tr></table></figure></p>
<p>ä¼šåœ¨æ•°æ®åº“ä¸­åˆ›å»ºTODOè¿™ä¸ªè¡¨ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œä½ å†è®¿é—®localhost:8080/todosè¿™ä¸ªAPIç¨‹åºå°±ä¸ä¼šæŠ¥é”™äº†ã€‚è¿™ä¸ªæ•°æ®åº“æ˜¯å»ºåœ¨å¦å¤–ä¸€ä¸ªå®¹å™¨é‡Œçš„ã€‚æˆ‘ä»¬æ—¢å¯ä»¥é€šè¿‡è¿è¡Œå‘½ä»¤ï¼š<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker-compose up app</span></span><br></pre></td></tr></table></figure></p>
<p>è®©å‰ä¸€ä¸ªå®¹å™¨é‡Œçš„appå¯åŠ¨ï¼Œç„¶åé€šè¿‡localhost:8080/todoså»è®¿é—®æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨Xcodeä¸­è¿è¡Œappï¼Œç„¶åé€šè¿‡è¿™ä¸ªURLå»è®¿é—®æ•°æ®åº“ã€‚æ•°æ®åº“æ˜¯åŒä¸€ä¸ªï¼Œä½†æ˜¯è·‘èµ·æ¥çš„appå´æ˜¯ä¸¤ä¸ªã€‚Xcodeè·‘çš„é‚£ä¸ªæ˜¯å¼€å‘ç”¨çš„ã€‚å®¹å™¨é‡Œçš„è¿™ä¸ªç”¨æ¥å‘å¸ƒçš„ã€‚</p>
<p>å¦‚æœè¿è¡Œå‘½ä»¤ï¼š<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker-compose build</span></span><br></pre></td></tr></table></figure></p>
<p>å®ƒä¼šæ‰§è¡Œ<code>Dockerfile</code>é‡Œçš„å‘½ä»¤ã€‚ä¹Ÿå°±æ˜¯è¯´å’Œå‰é¢docker buildçš„å‘½ä»¤å·®ä¸å¤šã€‚</p>
<p>è¿™äº›å‘½ä»¤åœ¨<code>docker-compose.yml</code>ä¸­éƒ½æœ‰è¯´æ˜ã€‚</p>
<p>æœ€åæˆ‘å‘ç°åŸæ¥dockeråœ¨å›½å†…æœ‰é•œåƒï¼Œå¯ä»¥åŠ é€Ÿä¸‹è½½imagesã€‚å…·ä½“æ–¹æ³•çœ‹<a href="https://yeasy.gitbooks.io/docker_practice/install/mirror.html" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚è¿™ä¸ªåšå®¢å¾ˆä¸é”™ï¼Œå›å¤´çœ‹çœ‹æŠŠDockerçš„çŸ¥è¯†è¡¥ä¸€è¡¥ã€‚</p>
<p>æ–‡ä¸­å…³äºDockerçš„è§£é‡Šï¼Œæˆ‘åŠé ç†è§£åŠé çŒœï¼Œä½†æ— è®ºå¦‚ä½•appæ˜¯è·‘èµ·æ¥äº†ï¼Œæ•°æ®åº“ä¹Ÿé€šäº†ã€‚åé¢æ…¢æ…¢ç»ƒæ‰‹ï¼Œæ…¢æ…¢å¡«å‘ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/03/13/Vapor4-0Xcodeä¼ å‚/" itemprop="url">
                  Vapor4.0Xcodeä¼ å‚
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2020-03-13T20:50:10+08:00" content="Mar 13 2020">
              Mar 13 2020
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å¤ªéš¾äº†ã€‚</p>
<p>æ¯ä¸€ä¸ªé¡¹ç›®éƒ½è¦é‡æ–°ä¸‹è½½Swift Package Dependenciesï¼Œå¹¶ä¸ä¼šæŠŠç›¸åŒçš„åº“åƒNodejsé‚£æ ·å…¨å±€åœ°è£…åœ¨æœ¬åœ°ã€‚</p>
<p>å‘½ä»¤è¡Œè¿è¡Œå’ŒXcodeè¿è¡Œï¼Œä»–ä»¬éœ€è¦ä¸‹è½½çš„Swift Package Dependenciesåœ¨ä¸åŒçš„ä½ç½®ã€‚æˆ‘æœ¬æ¥åœ¨Xcodeé…ç½®ç¯å¢ƒå˜é‡ï¼Œæƒ³ç”¨å‘½ä»¤è¡ŒéªŒè¯ä¸€ä¸‹ï¼Œç»“æœï¼Œå‘½ä»¤è¡Œä¹Ÿè¦é‡æ–°ä¸‹è½½ä¸€éè¿™äº›åŒ…ã€‚é»‘è„¸â€¦</p>
<p>è®°å½•ä¸€ä¸‹Xcodeä¸­ç¯å¢ƒé…ç½®çš„ä½ç½®å§ã€‚ä¸Šè¾¹å¯ä»¥é…ç½®ç¯å¢ƒã€‚ä¸‹è¾¹å¯ä»¥é…ç½®æ•°æ®åº“çš„ä¿¡æ¯ã€‚</p>
<img src="/2020/03/13/Vapor4-0Xcodeä¼ å‚/QQ20200313-210331.png">
<p>å¤§ç¥è¯´å‘½ä»¤è¡Œé…ç½®åº”è¯¥è¿™æ · <code>EXPORT DATABASE_HOST=vapor; vapor-beta run</code>, å› ä¸ºå‘½ä»¤è¡Œä¸‹åŒ…è¿˜æ²¡ä¸‹ä¸‹æ¥ï¼Œæ²¡æœ‰éªŒè¯ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/03/13/Vapor4-0æ¦‚å¿µ/" itemprop="url">
                  Vapor4.0æ¦‚å¿µ
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2020-03-13T10:34:02+08:00" content="Mar 13 2020">
              Mar 13 2020
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Vapor4-0/" itemprop="url" rel="index">
                    <span itemprop="name">Vapor4.0</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æœ€è¿‘æ‰“ç®—å­¦ä¹ ä¸€ä¸‹åç«¯çš„çŸ¥è¯†ï¼Œå¿ƒæƒ³æ€æ ·Javascriptæ˜¯ç»•ä¸å¼€çš„ï¼Œå°±å­¦Nodejså§ã€‚å­¦ä¹ äº†ä¸€ä¸ªæ˜ŸæœŸçš„Javascriptå’ŒNodejsï¼Œæœ€åè¯»äº†ã€Šæ·±å…¥æµ…å‡ºNode.jsã€‹æœ‰å…³Nodejsçš„å†å²ï¼Œè½¬èº«å°±è·‘å»å­¦Vaporäº†ã€‚</p>
<p>å¹³å°çš„å‘å±•éƒ½éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œä¹Ÿæœ‰äººåšå®šçš„ä»ä¸€å¼€å§‹èµ°è¿‡æ¥ã€‚Swiftç”¨èµ·æ¥é‚£ä¹ˆé¡ºï¼Œåˆç»è¿‡å‡ å¹´çš„æ²‰æ·€ã€‚ç°åœ¨æ˜¯æ—¶å€™è®¤çœŸæä¸€æäº†ã€‚</p>
<p>ç°åœ¨çš„æƒ³æ³•æ˜¯å…ˆå»ºä¸ªåšå®¢ç»ƒç»ƒæ‰‹ï¼Œåç«¯ç”¨Vapor4.0ï¼Œå‰ç«¯ç”¨Vue.jsã€‚ä¸¤ä¸ªæŠ€æœ¯ä¸€èµ·å­¦ã€‚å°†æ¥å¯èƒ½æŠŠè¿™ä¸ªåšå®¢è¿ç§»è¿‡å»ã€‚</p>
<p>Vapor4.0çš„æ–‡æ¡£è¿˜ä¸å¤Ÿå®Œå–„ï¼Œå¤§ä½¬ä»¬å»ºè®®ä»<a href="https://github.com/vapor/api-template" target="_blank" rel="noopener">vapor / api-template</a>è¿™é‡Œæèµ·ï¼Œè®°å¾—åˆ†æ”¯é€‰<code>4</code>ã€‚</p>
<p>å¯¹Vapor4è¦æœ‰å¤§æ¦‚çš„äº†è§£æ‰èƒ½ç»§ç»­ä¸‹å»ã€‚çœ‹åˆ°Nodejsä¸»è¦æ˜¯é€šè¿‡<code>EventLoop</code>æ¥æ¥æ”¶è¯·æ±‚çš„ã€‚å°±é—®é—®å¤§ä½¬ä»¬Vaporæ˜¯æ€ä¹ˆä¸ªæœºåˆ¶ã€‚çƒ­å¿ƒçš„å¤§ä½¬å›å¤è¯´Vaporåº•å±‚ç”¨çš„SwiftNIO,å…¶åº•å±‚çš„é€»è¾‘å’ŒNodejså·®ä¸å¤šï¼ŒSwiftNIOçš„è¿™ä¸ªæœºåˆ¶å«åš<code>EventLoopFuture</code>ã€‚ç½‘ä¸ŠæŸ¥äº†äº›<a href="https://www.raywenderlich.com/1124580-swiftnio-a-simple-guide-to-async-on-the-server" target="_blank" rel="noopener">èµ„æ–™</a>, æ‘˜å½•å¦‚ä¸‹:</p>
<blockquote>
<p><strong>The Event Loop</strong></p>
</blockquote>
<blockquote>
<p>Efficiency is an important goal when writing server-side code. The more efficient your code, the more users it can help concurrently. Where an unoptimized app can only help ten to a hundred users at a time, highly optimized apps are able to help a hundred-thousand concurrent users on the same hardware.</p>
</blockquote>
<blockquote>
<p>The main reason for this difference is architectural. A poorly optimized app will be idle most of the time, whereas a highly optimized app will try to spend its time cleverly and actively. The brains behind this architecture in server-side Swift is provided by SwiftNIO, Appleâ€™s cross-platform event-driven networking framework, by a type called EventLoop.</p>
</blockquote>
<blockquote>
<p>EventLoop is, in its essence, a while loop that keeps looking to do work when an external factor, such as a user uploading a file, has made progress.</p>
</blockquote>
<blockquote>
<p>If one thread writes to a variable, and another thread tries to read it or write to it at the same time, a race condition occurs, which will crash your app. One method you can use to prevent race conditions from occurring is using locks for each of these variables. Youâ€™ll lock this lock before accessing a variable and unlock is after accessing it is completed, so any future accesses to the resource are prevented until youâ€™ll unlock the lock. The main downside of this approach is its complexity and impact on performance.</p>
</blockquote>
<blockquote>
<p>Using a single thread to access this information is another way to tackle the issue of race conditions. Doing this means all read and write operations are done by this thread. One example of this is the database youâ€™ll find in the sample project. Using this method requires you to give the read/write thread a way to return the result to the event loop that requested it.</p>
</blockquote>
<blockquote>
<p>If you respond to a request from a different EventLoop, SwiftNIO will crash the app to prevent undefined behaviour from causing trouble.</p>
</blockquote>
<blockquote>
<p><strong>Futures and Promises</strong></p>
</blockquote>
<blockquote>
<p>Future is a type used to describe information that does not exist yet, but will exist in the future. Writing asynchronous code with futures means directing the futures to respond to the successful results or to the failures. You can create a future with a predefined result: either success or failure. However, if the result is not known yet, you need to create a Promise.</p>
</blockquote>
<blockquote>
<p>These promises and futures need to be created from the EventLoop since the future type will always return to the event loop it originated from. A future can only hold one result at a time, at which point it is considered completed. Completion can be either successful or unsuccessful, thus failed futures are also considered completed. Finally, if a promise is creates, it must be completed.</p>
</blockquote>
<p>ç°åœ¨å°±å¼€å§‹å»ºç«‹è‡ªå·±çš„æ–°é¡¹ç›®å§ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/13/Android-ä¸‰å¼ å›¾æå®šTouchäº‹ä»¶ä¼ é€’æœºåˆ¶/" itemprop="url">
                  Android-ä¸‰å¼ å›¾æå®šTouchäº‹ä»¶ä¼ é€’æœºåˆ¶
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-11-13T10:56:59+08:00" content="Nov 13 2017">
              Nov 13 2017
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è½¬è‡ª: <a href="http://hanhailong.com/2015/09/24/Android-ä¸‰å¼ å›¾æå®šTouchäº‹ä»¶ä¼ é€’æœºåˆ¶/" target="_blank" rel="noopener">Android-ä¸‰å¼ å›¾æå®šTouchäº‹ä»¶ä¼ é€’æœºåˆ¶</a></p>
<p>ä¹‹å‰çœ‹äº†å¾ˆå¤šå…³äºAndroidäº‹ä»¶Touchä¼ é€’æœºåˆ¶çš„æ–‡ç« ï¼Œæ„Ÿè§‰è¿˜æ˜¯è€å¤–è®²çš„æœ€æ¸…æ¥šã€‚åŸç‰ˆPDFåœ°å€ï¼š<a href="http://wugengxin.cn/download/pdf/android/PRE_andevcon_mastering-the-android-touch-system.pdf" target="_blank" rel="noopener">Mastering the Android Touch System</a>ï¼Œgithubçš„demoåœ°å€ï¼š<a href="https://github.com/devunwired/custom-touch-examples" target="_blank" rel="noopener">demo</a></p>
<p>ä¸Šå›¾ä¹‹å‰å…ˆè®²ä¸‹Androidäº‹ä»¶çš„åŸºç¡€çŸ¥è¯†ï¼š</p>
<ol>
<li>æ‰€æœ‰çš„Touchäº‹ä»¶éƒ½å°è£…åˆ°MotionEventé‡Œé¢</li>
<li>äº‹ä»¶å¤„ç†åŒ…æ‹¬ä¸‰ç§æƒ…å†µï¼Œåˆ†åˆ«ä¸ºï¼šä¼ é€’â€”-dispatchTouchEvent()å‡½æ•°ã€æ‹¦æˆªâ€”â€”onInterceptTouchEvent()å‡½æ•°ã€æ¶ˆè´¹â€”-onTouchEvent()å‡½æ•°å’ŒOnTouchListener </li>
<li>äº‹ä»¶ç±»å‹åˆ†ä¸ºACTION_DOWN, ACTION_UP, ACTION_MOVE, ACTION_POINTER_DOWN, ACTION_POINTER_UP, ACTION_CANCELç­‰ï¼Œæ¯ä¸ªäº‹ä»¶éƒ½æ˜¯ä»¥ACTION_DOWNå¼€å§‹ACTION_UPç»“æŸ</li>
</ol>
<p>Androidäº‹ä»¶ä¼ é€’æµç¨‹ï¼š</p>
<ol>
<li><p>äº‹ä»¶éƒ½æ˜¯ä»Activity.dispatchTouchEvent()å¼€å§‹ä¼ é€’</p>
</li>
<li><p>äº‹ä»¶ç”±çˆ¶Viewä¼ é€’ç»™å­Viewï¼ŒViewGroupå¯ä»¥é€šè¿‡onInterceptTouchEvent()æ–¹æ³•å¯¹äº‹ä»¶æ‹¦æˆªï¼Œåœæ­¢å…¶å‘å­viewä¼ é€’</p>
</li>
<li><p>å¦‚æœäº‹ä»¶ä»ä¸Šå¾€ä¸‹ä¼ é€’è¿‡ç¨‹ä¸­ä¸€ç›´æ²¡æœ‰è¢«åœæ­¢ï¼Œä¸”æœ€åº•å±‚å­Viewæ²¡æœ‰æ¶ˆè´¹äº‹ä»¶ï¼Œäº‹ä»¶ä¼šåå‘å¾€ä¸Šä¼ é€’ï¼Œè¿™æ—¶çˆ¶View(ViewGroup)å¯ä»¥è¿›è¡Œæ¶ˆè´¹ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰è¢«æ¶ˆè´¹çš„è¯ï¼Œæœ€åä¼šåˆ°Activityçš„onTouchEvent()å‡½æ•°ã€‚</p>
</li>
<li><p>å¦‚æœViewæ²¡æœ‰å¯¹ACTION_DOWNè¿›è¡Œæ¶ˆè´¹ï¼Œä¹‹åçš„å…¶ä»–äº‹ä»¶ä¸ä¼šä¼ é€’è¿‡æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ACTION_DOWNå¿…é¡»è¿”å›trueï¼Œä¹‹åçš„äº‹ä»¶æ‰ä¼šä¼ é€’è¿›æ¥</p>
</li>
<li><p>OnTouchListenerä¼˜å…ˆäºonTouchEvent()å¯¹äº‹ä»¶è¿›è¡Œæ¶ˆè´¹</p>
<hr>
<p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>Viewä¸å¤„ç†äº‹ä»¶æµç¨‹å›¾ï¼ˆViewæ²¡æœ‰æ¶ˆè´¹äº‹ä»¶ï¼‰</p>
<img src="/2017/11/13/Android-ä¸‰å¼ å›¾æå®šTouchäº‹ä»¶ä¼ é€’æœºåˆ¶/view_touch_ignorant.png.jpeg">
</li>
<li><p>Viewå¤„ç†äº‹ä»¶</p>
<img src="/2017/11/13/Android-ä¸‰å¼ å›¾æå®šTouchäº‹ä»¶ä¼ é€’æœºåˆ¶/view_touch_interested.png.jpeg">
</li>
<li><p>äº‹ä»¶æ‹¦æˆª</p>
<img src="/2017/11/13/Android-ä¸‰å¼ å›¾æå®šTouchäº‹ä»¶ä¼ é€’æœºåˆ¶/view_touch_intercept.png.jpeg">
</li>
</ol>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/08/Two-Tips-When-You-Setup-Firebase-For-Remote-Notification/" itemprop="url">
                  Two Tips When You Setup Firebase for Remote Notification
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-04-08T16:24:00+08:00" content="Apr 8 2017">
              Apr 8 2017
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>I finished my first android app written by Kotlin language recently. Today I want to record what I learned when I setup Firebase for remote notification.</p>
<p>There are two cases to disucuss.</p>
<h2 id="1-When-the-app-is-in-foreground"><a href="#1-When-the-app-is-in-foreground" class="headerlink" title="1. When the app is in foreground."></a>1. When the app is in foreground.</h2><p>This case is easier, when the push is coming, the callback method <code>onMessageReceived</code> in the class which extends <code>FirebaseMessagingService</code> will be invoked. </p>
<h2 id="2-When-the-app-is-in-the-background-or-is-killed"><a href="#2-When-the-app-is-in-the-background-or-is-killed" class="headerlink" title="2. When the app is in the background or is killed."></a>2. When the app is in the background or is killed.</h2><p>Under this case, the notification will show in the system tray first. when we click the notification, the app launcher will be open by default. We can get the push information from its <code>intent</code>.</p>
<p>But if you donâ€™t want the default action, for example, in my app, the launcher is a Splash activity, I donâ€™t want to deal with push information in the activity, how we can do?</p>
<p>Now, let us see how to send push to devices.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Method - POST</span><br><span class="line"></span><br><span class="line">EndPoint - <span class="string">https:</span><span class="comment">//fcm.googleapis.com/fcm/send</span></span><br><span class="line"></span><br><span class="line">Header - </span><br><span class="line"></span><br><span class="line"><span class="string">Authorization:</span>key=appkey</span><br><span class="line"></span><br><span class="line">Content-<span class="string">Type:</span>application/json</span><br><span class="line"></span><br><span class="line">Body - </span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"notification"</span>: &#123;</span><br><span class="line">		<span class="string">"title"</span>: <span class="string">"Your Title"</span>,</span><br><span class="line">		 <span class="string">"text"</span>: <span class="string">"Your Text"</span>,</span><br><span class="line">		 <span class="string">"body"</span>: <span class="string">"Your body"</span>,</span><br><span class="line">		 <span class="string">"click_action"</span> : <span class="string">"PUSH"</span></span><br><span class="line">	&#125;,</span><br><span class="line"><span class="string">"data"</span>: &#123;</span><br><span class="line">    	<span class="string">"url"</span>: <span class="string">"xxx"</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="string">"to"</span> : <span class="string">"pushToken"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The key-value <code>click_action</code> is the key point. I want MainActivity to initialize when the push is coming, so I config MainActivity in <code>AndroidManifest.xml</code> file</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity    android:name=<span class="string">".activities.MainActivity"</span>    android:configChanges=<span class="string">"keyboardHidden|orientation"</span>    </span><br><span class="line">android:launchMode=<span class="string">"singleInstance"</span>    </span><br><span class="line">android:screenOrientation=<span class="string">"portrait"</span>&gt;    </span><br><span class="line">	&lt;intent-filter&gt;        </span><br><span class="line">	&lt;action android:name=<span class="string">"PUSH"</span> /&gt;        </span><br><span class="line">	&lt;category android:name=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;   </span><br><span class="line">	&lt;/intent-filter&gt;</span><br><span class="line">&lt;/activity&gt;</span><br></pre></td></tr></table></figure>
<p>Note the actionâ€™s name in <code>intent-filter</code> is same with the value of the key <code>click_action</code>.</p>
<p>Further more, if the MainActivity is in the background, I donâ€™t want to initilize a new one, so I set <code>android:launchMode=&quot;singleInstance&quot;</code> . This way, when the push is coming out, we can get its <code>intent</code> from the following callback method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">override fun <span class="title">onNewIntent</span><span class="params">(intent: Intent?)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (intent != <span class="keyword">null</span> &amp;&amp; intent.action == <span class="string">"PUSH"</span> &amp;&amp; intent.getStringExtra(<span class="string">"url"</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            requestPushContent(intent.getStringExtra(<span class="string">"url"</span>))</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Done!</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/02/RxSwift-application-architectures/" itemprop="url">
                  RxSwift Application Architectures
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-11-02T10:34:13+08:00" content="Nov 2 2016">
              Nov 2 2016
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/RxSwift/" itemprop="url" rel="index">
                    <span itemprop="name">RxSwift</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>View Controllers</li>
<li>View Models</li>
<li>Models</li>
<li>Backend services</li>
<li>AppCoordinator (Singleton)</li>
</ol>
<p>More references:</p>
<p><a href="https://slack-files.com/T051G5Y6D-F0HABHKDK-8e9141e191" target="_blank" rel="noopener">https://slack-files.com/T051G5Y6D-F0HABHKDK-8e9141e191</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/31/MVVM-Philosophy/" itemprop="url">
                  MVVM Philosophy
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-10-31T15:59:02+08:00" content="Oct 31 2016">
              Oct 31 2016
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/MVVM/" itemprop="url" rel="index">
                    <span itemprop="name">MVVM</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Philosophy"><a href="#Philosophy" class="headerlink" title="Philosophy"></a><a href="https://github.com/devxoul/RxTodo" target="_blank" rel="noopener">Philosophy</a></h2><ul>
<li><p>View doesnâ€™t have control flow. View cannot modify the data. View only knows how to map the data.</p>
<p>  <strong>Bad</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viewModel.title</span><br><span class="line">    .<span class="built_in">map</span> &#123; $<span class="number">0</span> + <span class="string">"!"</span> &#125; <span class="comment">// Bad: View should not modify the data</span></span><br><span class="line">    .bindTo(<span class="keyword">self</span>.titleLabel)</span><br></pre></td></tr></table></figure>
<p>  <strong>Good</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">viewModel.title</span><br><span class="line">    .bindTo(<span class="keyword">self</span>.titleLabel)</span><br></pre></td></tr></table></figure>
</li>
<li><p>View doesnâ€™t know what ViewModel does. View can only communicate to ViewModel about what View did.</p>
<p>  <strong>Bad</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viewModel.login() <span class="comment">// Bad: View should not know what ViewModel does (login)</span></span><br></pre></td></tr></table></figure>
<p>  <strong>Good</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.loginButton.rx_tap</span><br><span class="line">    .bindTo(viewModel.loginButtonDidTap) <span class="comment">// "Hey I clicked the login button"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">self</span>.usernameInput.rx_controlEvent(.<span class="type">EditingDidEndOnExit</span>)</span><br><span class="line">    .bindTo(viewModel.usernameInputDidReturn) <span class="comment">// "Hey I tapped the return on username input"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Model is hidden by ViewModel. ViewModel only exposes the minimum data so that View can render.</p>
<p>  <strong>Bad</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ProductViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> product: <span class="type">Driver</span>&lt;<span class="type">Product</span>&gt; <span class="comment">// Bad: ViewModel should hide Model</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  <strong>Good</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ProductViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> productName: <span class="type">Driver</span>&lt;<span class="type">String</span>&gt;</span><br><span class="line">    <span class="keyword">let</span> formattedPrice: <span class="type">Driver</span>&lt;<span class="type">String</span>&gt;</span><br><span class="line">    <span class="keyword">let</span> formattedOriginalPrice: <span class="type">Driver</span>&lt;<span class="type">String</span>&gt;</span><br><span class="line">    <span class="keyword">let</span> originalPriceHidden: <span class="type">Driver</span>&lt;<span class="type">Bool</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<img src="/2016/10/31/MVVM-Philosophy/mvvm.png">
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="Changwei">
          <p class="site-author-name" itemprop="name">Changwei</p>
          <p class="site-description motion-element" itemprop="description">I develop iOS/Android apps with Swift/Kotlin language.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">74</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">34</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/cwtututu" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/thankforyou" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://cn.linkedin.com/pub/vale-tu/71/527/3a1/" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Linkedin
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.upwork.com/o/profiles/users/_~01eeefc89751549361/" target="_blank" title="Upwork">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Upwork
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.peopleperhour.com/freelancer/changwei/tu/ios-android-developer-parse-layer/986083" target="_blank" title="peopleperhour">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  peopleperhour
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons">
            </a>
          </div>
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Changwei</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
