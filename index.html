<!doctype html>



  


<html class="theme-next muse use-motion">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="iOS Development, iPhone Development, Android Development, API Development">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1">






<meta name="description" content="I develop iOS/Android apps with Swift/Kotlin language.">
<meta property="og:type" content="website">
<meta property="og:title" content="Changwei&#39;s Blog">
<meta property="og:url" content="http://tuchangwei.github.com/index.html">
<meta property="og:site_name" content="Changwei&#39;s Blog">
<meta property="og:description" content="I develop iOS/Android apps with Swift/Kotlin language.">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Changwei&#39;s Blog">
<meta name="twitter:description" content="I develop iOS/Android apps with Swift/Kotlin language.">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://tuchangwei.github.com/">

  <title> Changwei's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Changwei's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">I develop iOS/Android apps with Swift/Kotlin language.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/aboutme" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/03/15/Vapor4-0å­¦ä¹ è®°å½•3/" itemprop="url">
                  Vapor4.0å­¦ä¹ è®°å½•3
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2020-03-15T10:54:37+08:00" content="Mar 15 2020">
              Mar 15 2020
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æ˜¨å¤©å‘¨å…­ï¼Œè¢«Dockerä¸­é…ç½®Vaporæåˆ°è„‘è¢‹è¦ç‚¸ï¼Œå·®ä¸€ç‚¹æ”¾å¼ƒVaporçš„å­¦ä¹ ã€‚ä½†ä»Šå¤©æ„Ÿè§‰è¿˜å¥½ï¼Œè„‘ç‚¸æ˜¯æºäºå¯¹æœªçŸ¥çš„ææƒ§ã€‚</p>
<p>æœ¬èº«ç›¸å…³çš„åŒ…ä¾èµ–ä¸‹è½½å°±éå¸¸çš„è€—æ—¶ï¼Œç¨ä¸ªä¸æ…è¿˜è¦é‡æ–°ä¸‹è½½ï¼Œç®€ç›´å¥”æºƒã€‚</p>
<p>æˆ‘çš„æƒ³æ³•æ˜¯å…ˆå»ºä¸ªæ¨¡ç‰ˆé¡¹ç›®å‘å¸ƒä¸€ä¸‹ï¼Œç†Ÿæ‚‰æ•´ä¸ªæµç¨‹åï¼Œå°±è¾¹åŠ åŠŸèƒ½è¾¹å‘å¸ƒã€‚å› ä¸ºè¦ä¿æŒç¯å¢ƒçš„ä¸€è‡´æ€§ï¼ŒVaporç¤¾åŒºæ¯”è¾ƒæ¨èåœ¨Dockerä¸­éƒ¨ç½²ï¼Œç„¶åå†æŠŠDockeréƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œæ¨¡ç‰ˆé¡¹ç›®ä¸­ä¹Ÿæä¾›äº†ä¸¤ä¸ªDockerç›¸å…³çš„æ–‡ä»¶ <code>Dockerfile</code> å’Œ <code>docker-compose.yml</code>ã€‚ä½†æ˜¯ç½‘ç»œä¸Šå…³äºDockeréƒ¨ç½²Vapor4çš„èµ„æ–™ç®€ç›´æ˜¯æ²¡æœ‰ï¼Œçœ‹ç€ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„å‘½ä»¤å°±å¤´å¤§ã€‚è„‘ä¸­çš„é—®é¢˜ä¸€ç›´åœ¨é£ï¼š æœ¬åœ°é¡¹ç›®æ€ä¹ˆéƒ¨ç½²åˆ°Dockerå®¹å™¨ä¸­ï¼Ÿæ˜¯ä¸æ˜¯è¦å…ˆåœ¨å®¹å™¨ä¸­å®‰è£…Swiftå’ŒPostpostgres?éƒ¨ç½²çš„é¡¹ç›®å’Œpostpostrgesæ˜¯åŒä¸€ä¸ªå®¹å™¨ï¼Œè¿˜æ˜¯ä¸¤ä¸ªå®¹å™¨ï¼Ÿè¿™ä¸¤ä¸ªå®¹å™¨æ€ä¹ˆäº¤æµï¼Ÿæœ¬åœ°é¡¹ç›®åšäº†æ›´æ”¹åï¼ŒDockerä¸­çš„é¡¹ç›®ä¼šè‡ªåŠ¨æ›´æ”¹å—ï¼Ÿè¿™äº›é—®é¢˜æ€ä¹ˆç”¨å‘½ä»¤è¡Œè§£å†³ï¼Ÿè°æƒ³è°è„‘ç‚¸ã€‚</p>
<p>æ­£å½“æˆ‘è¦æ”¾å¼ƒçš„æ—¶å€™ï¼Œç¤¾åŒºçš„æ¸©æš–é€æ¥äº†ğŸ™ã€‚</p>
<blockquote>
<p>Deploying with docker is quite easy. Assuming you want to deploy a fresh Vapor 4 project:</p>
</blockquote>
<blockquote>
<p>Requirements: Install latest Xcode 11.4 Beta and switch to Swift 5.2 in the preferences. (You can check in the command line using swift â€“version) If you want to use Docker locally on your Mac, you should install Docker Desktop for Mac. </p>
</blockquote>
<blockquote>
<p>Run <code>vapor new --branch=4 myProject</code> to create a fresh project from template. (You can do any changes if you want, but the fresh template already provides a Hello World example.)</p>
</blockquote>
<blockquote>
<p>To run your application within Docker, there is already a <code>web.Dockerfile</code> provided in the template.<br>Weâ€™ll have to build an image first. Run <code>docker build -f web.Dockerfile -t my-project .</code>  Of course you can use whatever tag (my-project) you like.<br>To test your image locally use <code>docker run --rm -p 8080:80 my-project</code> (We use â€“rm to delete the container when we stop the app. The flag -p 8080:80 exposes the port 80 from within the container to port 8080 on our host.) You will see something like [ NOTICE ] Server starting on <a href="http://0.0.0.0:80" target="_blank" rel="noopener">http://0.0.0.0:80</a> in the command line. Visit <a href="http://localhost:8080/" target="_blank" rel="noopener">http://localhost:8080/</a> in your browser and you should see â€œIt works!â€ from your Vapor application.</p>
</blockquote>
<blockquote>
<p>If you make changes to your application, stop the container, build and run it again.</p>
</blockquote>
<p>æ‰€ä»¥ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡ï¼Œå…ˆåœ¨é¡¹ç›®ç›®å½•ä¸‹è¾“å…¥å¦‚ä¸‹å‘½ä»¤:</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">docker</span> <span class="keyword">build </span>-f Dockerfile -t tblog .</span><br></pre></td></tr></table></figure>
<p>é¡¹ç›®å°±å¼€å§‹åœ¨Dockerä¸­å®‰è£…äº†ã€‚æ³¨æ„å‘½ä»¤åé¢é‚£ä¸ª<code>.</code>åˆ«å¿˜äº†ï¼Œé‚£ä¸ªæ˜¯å½“å‰ç›®å½•çš„æ„æ€ã€‚</p>
<p>å®Œåæˆ‘æŒ‰ç…§ä¸Šé¢å¤§ä½¬çš„å‘½ä»¤ï¼š<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">run</span> <span class="comment">--rm -p 8080:80 tblog</span></span><br></pre></td></tr></table></figure></p>
<p>å¹¶æ²¡æœ‰æŠŠé¡¹ç›®è·‘èµ·æ¥ï¼Œè¿™é‡Œå¯ä»¥ä»ä¸¤å¤„åšä¸€ä¸‹æ›´æ”¹ã€‚ä¸€ä¸ªæ˜¯æŠŠå‘½ä»¤è¡Œæ”¹æˆï¼š<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">run</span> <span class="comment">--rm -p 8080:8080 tblog</span></span><br></pre></td></tr></table></figure></p>
<p>å¤§ä½¬è¯´dockeré»˜è®¤æš´éœ²çš„æ˜¯8080ç«¯å£ã€‚æˆ–è€…åœ¨<code>Dockerfile</code>æ–‡ä»¶ä¸­æŠŠæœ€åä¸€è¡Œæ”¹ä¸ºï¼š</p>
<blockquote>
<p>CMD [â€œserveâ€, â€œâ€“envâ€, â€œproductionâ€, â€œâ€“hostnameâ€, â€œ0.0.0.0â€, â€œâ€“portâ€, â€œ80â€]</p>
</blockquote>
<p>æŠŠ80ç«¯å£æš´éœ²å‡ºæ¥ã€‚</p>
<p><code>Dockerfile</code>é‡Œçš„å‘½ä»¤å¤§æ¦‚è§£é‡Šä¸€ä¸‹ï¼Œå°±æ˜¯å…ˆåœ¨Dockerå®¹å™¨é‡Œä¸‹è½½Swift5.2, ç„¶åæŠŠæœ¬åœ°çš„é¡¹ç›®æ‹·è´åˆ°å®¹å™¨é‡Œï¼Œç„¶åç¼–è¯‘ã€‚ç„¶åå†æŠŠUbuntuæ‹·è´ä¸‹æ¥ï¼ŒæŠŠç¼–è¯‘çš„æ–‡ä»¶æ”¾åœ¨Ubuntuçš„ç›®å½•ç»“æ„ä¸‹ã€‚ç„¶åè¿è¡Œã€‚</p>
<p>è¿™ä¸ªæ—¶å€™é¡¹ç›®è·‘èµ·æ¥æ˜¯æ²¡æœ‰æ•°æ®åº“çš„, è¿™ä¸ªæ—¶å€™<code>docker-compose.yml</code>è¿™ä¸ªæ–‡ä»¶å°±æœ‰ç”¨äº†ã€‚</p>
<p>è¿è¡Œå‘½ä»¤ï¼š<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose <span class="meta">up</span> <span class="built_in">db</span></span><br></pre></td></tr></table></figure></p>
<p>ä¼šå®‰è£…æ•°æ®åº“postgresï¼Œå¹¶å¯åŠ¨æ•°æ®åº“ã€‚</p>
<p>è¿è¡Œå‘½ä»¤ï¼š<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker-compose up migrate</span></span><br></pre></td></tr></table></figure></p>
<p>ä¼šåœ¨æ•°æ®åº“ä¸­åˆ›å»ºTOODè¿™ä¸ªè¡¨ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œä½ å†è®¿é—®localhost:8080/todosè¿™ä¸ªAPIç¨‹åºå°±ä¸ä¼šæŠ¥é”™äº†ã€‚è¿™ä¸ªæ•°æ®åº“æ˜¯å»ºåœ¨å¦å¤–ä¸€ä¸ªå®¹å™¨é‡Œçš„ã€‚æˆ‘ä»¬æ—¢å¯ä»¥é€šè¿‡è¿è¡Œå‘½ä»¤ï¼š<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker-compose up app</span></span><br></pre></td></tr></table></figure></p>
<p>è®©å‰ä¸€ä¸ªå®¹å™¨é‡Œçš„appå¯åŠ¨ï¼Œç„¶åé€šè¿‡localhost:8080/todoså»è®¿é—®æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨Xcodeä¸­è¿è¡Œappï¼Œç„¶åé€šè¿‡è¿™ä¸ªURLå»è®¿é—®æ•°æ®åº“ã€‚æ•°æ®åº“æ˜¯åŒä¸€ä¸ªï¼Œä½†æ˜¯è·‘èµ·æ¥çš„appå´æ˜¯ä¸¤ä¸ªã€‚Xcodeè·‘çš„é‚£ä¸ªæ˜¯å¼€å‘ç”¨çš„ã€‚å®¹å™¨é‡Œçš„è¿™ä¸ªç”¨æ¥å‘å¸ƒçš„ã€‚</p>
<p>å¦‚æœè¿è¡Œå‘½ä»¤ï¼š<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker-compose build</span></span><br></pre></td></tr></table></figure></p>
<p>å®ƒä¼šæ‰§è¡Œ<code>Dockerfile</code>é‡Œçš„å‘½ä»¤ã€‚ä¹Ÿå°±æ˜¯è¯´å’Œå‰é¢docker buildçš„å‘½ä»¤å·®ä¸å¤šã€‚</p>
<p>è¿™äº›å‘½ä»¤åœ¨<code>docker-compose.yml</code>ä¸­éƒ½æœ‰è¯´æ˜ã€‚</p>
<p>æœ€åæˆ‘å‘ç°åŸæ¥dockeråœ¨å›½å†…æœ‰é•œåƒï¼Œå¯ä»¥åŠ é€Ÿä¸‹è½½imagesã€‚å…·ä½“æ–¹æ³•çœ‹<a href="https://yeasy.gitbooks.io/docker_practice/install/mirror.html" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚è¿™ä¸ªåšå®¢å¾ˆä¸é”™ï¼Œå›å¤´çœ‹çœ‹æŠŠDockerçš„çŸ¥è¯†è¡¥ä¸€è¡¥ã€‚</p>
<p>æ–‡ä¸­å…³äºDockerçš„è§£é‡Šï¼Œæˆ‘åŠé ç†è§£åŠé çŒœï¼Œä½†æ— è®ºå¦‚ä½•appæ˜¯è·‘èµ·æ¥äº†ï¼Œæ•°æ®åº“ä¹Ÿé€šäº†ã€‚åé¢æ…¢æ…¢ç»ƒæ‰‹ï¼Œæ…¢æ…¢å¡«å‘ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/03/13/Vapor4-0å­¦ä¹ è®°å½•2/" itemprop="url">
                  Vapor4.0å­¦ä¹ è®°å½•2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2020-03-13T20:50:10+08:00" content="Mar 13 2020">
              Mar 13 2020
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å¤ªéš¾äº†ã€‚</p>
<p>æ¯ä¸€ä¸ªé¡¹ç›®éƒ½è¦é‡æ–°ä¸‹è½½Swift Package Dependenciesï¼Œå¹¶ä¸ä¼šæŠŠç›¸åŒçš„åº“åƒNodejsé‚£æ ·å…¨å±€åœ°è£…åœ¨æœ¬åœ°ã€‚</p>
<p>å‘½ä»¤è¡Œè¿è¡Œå’ŒXcodeè¿è¡Œï¼Œä»–ä»¬éœ€è¦ä¸‹è½½çš„Swift Package Dependenciesåœ¨ä¸åŒçš„ä½ç½®ã€‚æˆ‘æœ¬æ¥åœ¨Xcodeé…ç½®ç¯å¢ƒå˜é‡ï¼Œæƒ³ç”¨å‘½ä»¤è¡ŒéªŒè¯ä¸€ä¸‹ï¼Œç»“æœï¼Œå‘½ä»¤è¡Œä¹Ÿè¦é‡æ–°ä¸‹è½½ä¸€éè¿™äº›åŒ…ã€‚é»‘è„¸â€¦</p>
<p>è®°å½•ä¸€ä¸‹Xcodeä¸­ç¯å¢ƒé…ç½®çš„ä½ç½®å§ã€‚ä¸Šè¾¹å¯ä»¥é…ç½®ç¯å¢ƒã€‚ä¸‹è¾¹å¯ä»¥é…ç½®æ•°æ®åº“çš„ä¿¡æ¯ã€‚</p>
<img src="/2020/03/13/Vapor4-0å­¦ä¹ è®°å½•2/QQ20200313-210331.png">
<p>å¤§ç¥è¯´å‘½ä»¤è¡Œé…ç½®åº”è¯¥è¿™æ · <code>EXPORT DATABASE_HOST=vapor; vapor-beta run</code>, å› ä¸ºå‘½ä»¤è¡Œä¸‹åŒ…è¿˜æ²¡ä¸‹ä¸‹æ¥ï¼Œæ²¡æœ‰éªŒè¯ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/03/13/Vapor4-0å­¦ä¹ è®°å½•1/" itemprop="url">
                  Vapor4.0å­¦ä¹ è®°å½•1
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2020-03-13T10:34:02+08:00" content="Mar 13 2020">
              Mar 13 2020
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æœ€è¿‘æ‰“ç®—å­¦ä¹ ä¸€ä¸‹åç«¯çš„çŸ¥è¯†ï¼Œå¿ƒæƒ³æ€æ ·Javascriptæ˜¯ç»•ä¸å¼€çš„ï¼Œå°±å­¦Nodejså§ã€‚å­¦ä¹ äº†ä¸€ä¸ªæ˜ŸæœŸçš„Javascriptå’ŒNodejsï¼Œæœ€åè¯»äº†ã€Šæ·±å…¥æµ…å‡ºNode.jsã€‹æœ‰å…³Nodejsçš„å†å²ï¼Œè½¬èº«å°±è·‘å»å­¦Vaporäº†ã€‚</p>
<p>å¹³å°çš„å‘å±•éƒ½éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œä¹Ÿæœ‰äººåšå®šçš„ä»ä¸€å¼€å§‹èµ°è¿‡æ¥ã€‚Swiftç”¨èµ·æ¥é‚£ä¹ˆé¡ºï¼Œåˆç»è¿‡å‡ å¹´çš„æ²‰æ·€ã€‚ç°åœ¨æ˜¯æ—¶å€™è®¤çœŸæä¸€æäº†ã€‚</p>
<p>ç°åœ¨çš„æƒ³æ³•æ˜¯å…ˆå»ºä¸ªåšå®¢ç»ƒç»ƒæ‰‹ï¼Œåç«¯ç”¨Vapor4.0ï¼Œå‰ç«¯ç”¨Vue.jsã€‚ä¸¤ä¸ªæŠ€æœ¯ä¸€èµ·å­¦ã€‚å°†æ¥å¯èƒ½æŠŠè¿™ä¸ªåšå®¢è¿ç§»è¿‡å»ã€‚</p>
<p>Vapor4.0çš„æ–‡æ¡£è¿˜ä¸å¤Ÿå®Œå–„ï¼Œå¤§ä½¬ä»¬å»ºè®®ä»<a href="https://github.com/vapor/api-template" target="_blank" rel="noopener">vapor / api-template</a>è¿™é‡Œæèµ·ï¼Œè®°å¾—åˆ†æ”¯é€‰<code>4</code>ã€‚</p>
<p>å¯¹Vapor4è¦æœ‰å¤§æ¦‚çš„äº†è§£æ‰èƒ½ç»§ç»­ä¸‹å»ã€‚çœ‹åˆ°Nodejsä¸»è¦æ˜¯é€šè¿‡<code>EventLoop</code>æ¥æ¥æ”¶è¯·æ±‚çš„ã€‚å°±é—®é—®å¤§ä½¬ä»¬Vaporæ˜¯æ€ä¹ˆä¸ªæœºåˆ¶ã€‚çƒ­å¿ƒçš„å¤§ä½¬å›å¤è¯´Vaporåº•å±‚ç”¨çš„SwiftNIO,å…¶åº•å±‚çš„é€»è¾‘å’ŒNodejså·®ä¸å¤šï¼ŒSwiftNIOçš„è¿™ä¸ªæœºåˆ¶å«åš<code>EventLoopFuture</code>ã€‚ç½‘ä¸ŠæŸ¥äº†äº›<a href="https://www.raywenderlich.com/1124580-swiftnio-a-simple-guide-to-async-on-the-server" target="_blank" rel="noopener">èµ„æ–™</a>, æ‘˜å½•å¦‚ä¸‹:</p>
<blockquote>
<p><strong>The Event Loop</strong></p>
</blockquote>
<blockquote>
<p>Efficiency is an important goal when writing server-side code. The more efficient your code, the more users it can help concurrently. Where an unoptimized app can only help ten to a hundred users at a time, highly optimized apps are able to help a hundred-thousand concurrent users on the same hardware.</p>
</blockquote>
<blockquote>
<p>The main reason for this difference is architectural. A poorly optimized app will be idle most of the time, whereas a highly optimized app will try to spend its time cleverly and actively. The brains behind this architecture in server-side Swift is provided by SwiftNIO, Appleâ€™s cross-platform event-driven networking framework, by a type called EventLoop.</p>
</blockquote>
<blockquote>
<p>EventLoop is, in its essence, a while loop that keeps looking to do work when an external factor, such as a user uploading a file, has made progress.</p>
</blockquote>
<blockquote>
<p>If one thread writes to a variable, and another thread tries to read it or write to it at the same time, a race condition occurs, which will crash your app. One method you can use to prevent race conditions from occurring is using locks for each of these variables. Youâ€™ll lock this lock before accessing a variable and unlock is after accessing it is completed, so any future accesses to the resource are prevented until youâ€™ll unlock the lock. The main downside of this approach is its complexity and impact on performance.</p>
</blockquote>
<blockquote>
<p>Using a single thread to access this information is another way to tackle the issue of race conditions. Doing this means all read and write operations are done by this thread. One example of this is the database youâ€™ll find in the sample project. Using this method requires you to give the read/write thread a way to return the result to the event loop that requested it.</p>
</blockquote>
<blockquote>
<p>If you respond to a request from a different EventLoop, SwiftNIO will crash the app to prevent undefined behaviour from causing trouble.</p>
</blockquote>
<blockquote>
<p><strong>Futures and Promises</strong></p>
</blockquote>
<blockquote>
<p>Future is a type used to describe information that does not exist yet, but will exist in the future. Writing asynchronous code with futures means directing the futures to respond to the successful results or to the failures. You can create a future with a predefined result: either success or failure. However, if the result is not known yet, you need to create a Promise.</p>
</blockquote>
<blockquote>
<p>These promises and futures need to be created from the EventLoop since the future type will always return to the event loop it originated from. A future can only hold one result at a time, at which point it is considered completed. Completion can be either successful or unsuccessful, thus failed futures are also considered completed. Finally, if a promise is creates, it must be completed.</p>
</blockquote>
<p>ç°åœ¨å°±å¼€å§‹å»ºç«‹è‡ªå·±çš„æ–°é¡¹ç›®å§ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/13/Android-ä¸‰å¼ å›¾æå®šTouchäº‹ä»¶ä¼ é€’æœºåˆ¶/" itemprop="url">
                  Android-ä¸‰å¼ å›¾æå®šTouchäº‹ä»¶ä¼ é€’æœºåˆ¶
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-11-13T10:56:59+08:00" content="Nov 13 2017">
              Nov 13 2017
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è½¬è‡ª: <a href="http://hanhailong.com/2015/09/24/Android-ä¸‰å¼ å›¾æå®šTouchäº‹ä»¶ä¼ é€’æœºåˆ¶/" target="_blank" rel="noopener">Android-ä¸‰å¼ å›¾æå®šTouchäº‹ä»¶ä¼ é€’æœºåˆ¶</a></p>
<p>ä¹‹å‰çœ‹äº†å¾ˆå¤šå…³äºAndroidäº‹ä»¶Touchä¼ é€’æœºåˆ¶çš„æ–‡ç« ï¼Œæ„Ÿè§‰è¿˜æ˜¯è€å¤–è®²çš„æœ€æ¸…æ¥šã€‚åŸç‰ˆPDFåœ°å€ï¼š<a href="http://wugengxin.cn/download/pdf/android/PRE_andevcon_mastering-the-android-touch-system.pdf" target="_blank" rel="noopener">Mastering the Android Touch System</a>ï¼Œgithubçš„demoåœ°å€ï¼š<a href="https://github.com/devunwired/custom-touch-examples" target="_blank" rel="noopener">demo</a></p>
<p>ä¸Šå›¾ä¹‹å‰å…ˆè®²ä¸‹Androidäº‹ä»¶çš„åŸºç¡€çŸ¥è¯†ï¼š</p>
<ol>
<li>æ‰€æœ‰çš„Touchäº‹ä»¶éƒ½å°è£…åˆ°MotionEventé‡Œé¢</li>
<li>äº‹ä»¶å¤„ç†åŒ…æ‹¬ä¸‰ç§æƒ…å†µï¼Œåˆ†åˆ«ä¸ºï¼šä¼ é€’â€”-dispatchTouchEvent()å‡½æ•°ã€æ‹¦æˆªâ€”â€”onInterceptTouchEvent()å‡½æ•°ã€æ¶ˆè´¹â€”-onTouchEvent()å‡½æ•°å’ŒOnTouchListener </li>
<li>äº‹ä»¶ç±»å‹åˆ†ä¸ºACTION_DOWN, ACTION_UP, ACTION_MOVE, ACTION_POINTER_DOWN, ACTION_POINTER_UP, ACTION_CANCELç­‰ï¼Œæ¯ä¸ªäº‹ä»¶éƒ½æ˜¯ä»¥ACTION_DOWNå¼€å§‹ACTION_UPç»“æŸ</li>
</ol>
<p>Androidäº‹ä»¶ä¼ é€’æµç¨‹ï¼š</p>
<ol>
<li><p>äº‹ä»¶éƒ½æ˜¯ä»Activity.dispatchTouchEvent()å¼€å§‹ä¼ é€’</p>
</li>
<li><p>äº‹ä»¶ç”±çˆ¶Viewä¼ é€’ç»™å­Viewï¼ŒViewGroupå¯ä»¥é€šè¿‡onInterceptTouchEvent()æ–¹æ³•å¯¹äº‹ä»¶æ‹¦æˆªï¼Œåœæ­¢å…¶å‘å­viewä¼ é€’</p>
</li>
<li><p>å¦‚æœäº‹ä»¶ä»ä¸Šå¾€ä¸‹ä¼ é€’è¿‡ç¨‹ä¸­ä¸€ç›´æ²¡æœ‰è¢«åœæ­¢ï¼Œä¸”æœ€åº•å±‚å­Viewæ²¡æœ‰æ¶ˆè´¹äº‹ä»¶ï¼Œäº‹ä»¶ä¼šåå‘å¾€ä¸Šä¼ é€’ï¼Œè¿™æ—¶çˆ¶View(ViewGroup)å¯ä»¥è¿›è¡Œæ¶ˆè´¹ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰è¢«æ¶ˆè´¹çš„è¯ï¼Œæœ€åä¼šåˆ°Activityçš„onTouchEvent()å‡½æ•°ã€‚</p>
</li>
<li><p>å¦‚æœViewæ²¡æœ‰å¯¹ACTION_DOWNè¿›è¡Œæ¶ˆè´¹ï¼Œä¹‹åçš„å…¶ä»–äº‹ä»¶ä¸ä¼šä¼ é€’è¿‡æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ACTION_DOWNå¿…é¡»è¿”å›trueï¼Œä¹‹åçš„äº‹ä»¶æ‰ä¼šä¼ é€’è¿›æ¥</p>
</li>
<li><p>OnTouchListenerä¼˜å…ˆäºonTouchEvent()å¯¹äº‹ä»¶è¿›è¡Œæ¶ˆè´¹</p>
<hr>
<p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>Viewä¸å¤„ç†äº‹ä»¶æµç¨‹å›¾ï¼ˆViewæ²¡æœ‰æ¶ˆè´¹äº‹ä»¶ï¼‰</p>
<img src="/2017/11/13/Android-ä¸‰å¼ å›¾æå®šTouchäº‹ä»¶ä¼ é€’æœºåˆ¶/view_touch_ignorant.png.jpeg">
</li>
<li><p>Viewå¤„ç†äº‹ä»¶</p>
<img src="/2017/11/13/Android-ä¸‰å¼ å›¾æå®šTouchäº‹ä»¶ä¼ é€’æœºåˆ¶/view_touch_interested.png.jpeg">
</li>
<li><p>äº‹ä»¶æ‹¦æˆª</p>
<img src="/2017/11/13/Android-ä¸‰å¼ å›¾æå®šTouchäº‹ä»¶ä¼ é€’æœºåˆ¶/view_touch_intercept.png.jpeg">
</li>
</ol>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/08/Two-Tips-When-You-Setup-Firebase-For-Remote-Notification/" itemprop="url">
                  Two Tips When You Setup Firebase for Remote Notification
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-04-08T16:24:00+08:00" content="Apr 8 2017">
              Apr 8 2017
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>I finished my first android app written by Kotlin language recently. Today I want to record what I learned when I setup Firebase for remote notification.</p>
<p>There are two cases to disucuss.</p>
<h2 id="1-When-the-app-is-in-foreground"><a href="#1-When-the-app-is-in-foreground" class="headerlink" title="1. When the app is in foreground."></a>1. When the app is in foreground.</h2><p>This case is easier, when the push is coming, the callback method <code>onMessageReceived</code> in the class which extends <code>FirebaseMessagingService</code> will be invoked. </p>
<h2 id="2-When-the-app-is-in-the-background-or-is-killed"><a href="#2-When-the-app-is-in-the-background-or-is-killed" class="headerlink" title="2. When the app is in the background or is killed."></a>2. When the app is in the background or is killed.</h2><p>Under this case, the notification will show in the system tray first. when we click the notification, the app launcher will be open by default. We can get the push information from its <code>intent</code>.</p>
<p>But if you donâ€™t want the default action, for example, in my app, the launcher is a Splash activity, I donâ€™t want to deal with push information in the activity, how we can do?</p>
<p>Now, let us see how to send push to devices.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Method - POST</span><br><span class="line"></span><br><span class="line">EndPoint - <span class="string">https:</span><span class="comment">//fcm.googleapis.com/fcm/send</span></span><br><span class="line"></span><br><span class="line">Header - </span><br><span class="line"></span><br><span class="line"><span class="string">Authorization:</span>key=appkey</span><br><span class="line"></span><br><span class="line">Content-<span class="string">Type:</span>application/json</span><br><span class="line"></span><br><span class="line">Body - </span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"notification"</span>: &#123;</span><br><span class="line">		<span class="string">"title"</span>: <span class="string">"Your Title"</span>,</span><br><span class="line">		 <span class="string">"text"</span>: <span class="string">"Your Text"</span>,</span><br><span class="line">		 <span class="string">"body"</span>: <span class="string">"Your body"</span>,</span><br><span class="line">		 <span class="string">"click_action"</span> : <span class="string">"PUSH"</span></span><br><span class="line">	&#125;,</span><br><span class="line"><span class="string">"data"</span>: &#123;</span><br><span class="line">    	<span class="string">"url"</span>: <span class="string">"xxx"</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="string">"to"</span> : <span class="string">"pushToken"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The key-value <code>click_action</code> is the key point. I want MainActivity to initialize when the push is coming, so I config MainActivity in <code>AndroidManifest.xml</code> file</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity    android:name=<span class="string">".activities.MainActivity"</span>    android:configChanges=<span class="string">"keyboardHidden|orientation"</span>    </span><br><span class="line">android:launchMode=<span class="string">"singleInstance"</span>    </span><br><span class="line">android:screenOrientation=<span class="string">"portrait"</span>&gt;    </span><br><span class="line">	&lt;intent-filter&gt;        </span><br><span class="line">	&lt;action android:name=<span class="string">"PUSH"</span> /&gt;        </span><br><span class="line">	&lt;category android:name=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;   </span><br><span class="line">	&lt;/intent-filter&gt;</span><br><span class="line">&lt;/activity&gt;</span><br></pre></td></tr></table></figure>
<p>Note the actionâ€™s name in <code>intent-filter</code> is same with the value of the key <code>click_action</code>.</p>
<p>Further more, if the MainActivity is in the background, I donâ€™t want to initilize a new one, so I set <code>android:launchMode=&quot;singleInstance&quot;</code> . This way, when the push is coming out, we can get its <code>intent</code> from the following callback method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">override fun <span class="title">onNewIntent</span><span class="params">(intent: Intent?)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (intent != <span class="keyword">null</span> &amp;&amp; intent.action == <span class="string">"PUSH"</span> &amp;&amp; intent.getStringExtra(<span class="string">"url"</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            requestPushContent(intent.getStringExtra(<span class="string">"url"</span>))</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Done!</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/02/RxSwift-application-architectures/" itemprop="url">
                  RxSwift Application Architectures
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-11-02T10:34:13+08:00" content="Nov 2 2016">
              Nov 2 2016
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/RxSwift/" itemprop="url" rel="index">
                    <span itemprop="name">RxSwift</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>View Controllers</li>
<li>View Models</li>
<li>Models</li>
<li>Backend services</li>
<li>AppCoordinator (Singleton)</li>
</ol>
<p>More references:</p>
<p><a href="https://slack-files.com/T051G5Y6D-F0HABHKDK-8e9141e191" target="_blank" rel="noopener">https://slack-files.com/T051G5Y6D-F0HABHKDK-8e9141e191</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/31/MVVM-Philosophy/" itemprop="url">
                  MVVM Philosophy
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-10-31T15:59:02+08:00" content="Oct 31 2016">
              Oct 31 2016
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/MVVM/" itemprop="url" rel="index">
                    <span itemprop="name">MVVM</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Philosophy"><a href="#Philosophy" class="headerlink" title="Philosophy"></a><a href="https://github.com/devxoul/RxTodo" target="_blank" rel="noopener">Philosophy</a></h2><ul>
<li><p>View doesnâ€™t have control flow. View cannot modify the data. View only knows how to map the data.</p>
<p>  <strong>Bad</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viewModel.title</span><br><span class="line">    .<span class="built_in">map</span> &#123; $<span class="number">0</span> + <span class="string">"!"</span> &#125; <span class="comment">// Bad: View should not modify the data</span></span><br><span class="line">    .bindTo(<span class="keyword">self</span>.titleLabel)</span><br></pre></td></tr></table></figure>
<p>  <strong>Good</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">viewModel.title</span><br><span class="line">    .bindTo(<span class="keyword">self</span>.titleLabel)</span><br></pre></td></tr></table></figure>
</li>
<li><p>View doesnâ€™t know what ViewModel does. View can only communicate to ViewModel about what View did.</p>
<p>  <strong>Bad</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viewModel.login() <span class="comment">// Bad: View should not know what ViewModel does (login)</span></span><br></pre></td></tr></table></figure>
<p>  <strong>Good</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.loginButton.rx_tap</span><br><span class="line">    .bindTo(viewModel.loginButtonDidTap) <span class="comment">// "Hey I clicked the login button"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">self</span>.usernameInput.rx_controlEvent(.<span class="type">EditingDidEndOnExit</span>)</span><br><span class="line">    .bindTo(viewModel.usernameInputDidReturn) <span class="comment">// "Hey I tapped the return on username input"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Model is hidden by ViewModel. ViewModel only exposes the minimum data so that View can render.</p>
<p>  <strong>Bad</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ProductViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> product: <span class="type">Driver</span>&lt;<span class="type">Product</span>&gt; <span class="comment">// Bad: ViewModel should hide Model</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  <strong>Good</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ProductViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> productName: <span class="type">Driver</span>&lt;<span class="type">String</span>&gt;</span><br><span class="line">    <span class="keyword">let</span> formattedPrice: <span class="type">Driver</span>&lt;<span class="type">String</span>&gt;</span><br><span class="line">    <span class="keyword">let</span> formattedOriginalPrice: <span class="type">Driver</span>&lt;<span class="type">String</span>&gt;</span><br><span class="line">    <span class="keyword">let</span> originalPriceHidden: <span class="type">Driver</span>&lt;<span class="type">Bool</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<img src="/2016/10/31/MVVM-Philosophy/mvvm.png">
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/21/è¯‘-ä¸¤åˆ†é’Ÿä»‹ç»Rx/" itemprop="url">
                  [è¯‘]ä¸¤åˆ†é’Ÿä»‹ç»Rx
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-10-21T17:28:49+08:00" content="Oct 21 2016">
              Oct 21 2016
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Rx/" itemprop="url" rel="index">
                    <span itemprop="name">Rx</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>åŸæ–‡åœ¨<a href="https://medium.com/@andrestaltz/2-minute-introduction-to-rx-24c8ca793877#.ww2g1z3oo" target="_blank" rel="noopener">è¿™é‡Œ</a>, æœ¬æ–‡ç”¨<a href="http://www.typora.io/" target="_blank" rel="noopener">Typora</a>ç¼–è¾‘</strong></p>
<p>ä½ å¯èƒ½å·²ç»çœ‹äº†æˆ‘å†™çš„<a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ã€‚å¤ªé•¿äº†ï¼Ÿå¥½å§ã€‚</p>
<p>Rxå¹¶ä¸æ˜¯é‚£ä¹ˆéš¾ï¼Œä½ è‡ªå·±ä¹Ÿå¯ä»¥åˆ›é€ å®ƒã€‚ç»§ç»­é˜…è¯»å§ã€‚</p>
<p>ä½ çŸ¥é“æ•°ç»„å—ï¼Ÿä½ å½“ç„¶çŸ¥é“ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªï¼š</p>
<font style="font-size:30px;"><em>[14, 9, 5, 2, 10, 13, 4]</em></font>

<p></p><p></p>
<p>å¦‚æœæˆ‘å‘Šè¯‰ä½ è¿™æ˜¯ä¸ªä¸å¯å˜çš„æ•°ç»„ï¼Œä½ éœ€è¦æ‹¿èµ°æ‰€æœ‰çš„å¥‡æ•°ï¼Œä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªæµè¡Œçš„æ–¹å¼ï¼š</p>
<font style="font-size:30px;"><em>[14, 9, 5, 2, 10, 13, 4]</em><br><br><em>filter( (x) -&gt; x % 2 == 0 )</em><br><br><em>[ 14, 2, 10, 4 ]</em></font>

<p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæ²¡ä»€ä¹ˆæ–°ä¸œè¥¿ã€‚è¿™å¾ˆæ™®éï¼Œå®ƒæ¥è‡ªäºå‡½æ•°å¼ç¼–ç¨‹çš„èŒƒä¾‹ã€‚</p>
<p>â€¦</p>
<p>ç°åœ¨æƒ³è±¡ä¸€ä¸‹é¼ æ ‡ä½ç½®çš„ç‚¹å‡»äº‹ä»¶ã€‚å¦‚æœä½ æŠŠå®ƒä»¬ç”»åœ¨ä¸€ä¸ªæ—¶é—´çº¿ä¸Šï¼Œå®ƒä»¬çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p>
<img src="/2016/10/21/è¯‘-ä¸¤åˆ†é’Ÿä»‹ç»Rx/1-FjTqms95LbK_ztsZXiNpoQ.png">
<p>æœ‹å‹ï¼Œè¿™æ˜¯ä¸€ä¸ªäº‹ä»¶æµï¼Œæˆ‘ä»¬äº²åˆ‡çš„å«å®ƒ <code>Observable</code>ã€‚</p>
<p>è¿™ä¸ªç‚¹å‡»äº‹ä»¶æ¥è‡ªäºé¼ æ ‡ï¼Œå› æ­¤æ•´ä¸ªçš„äº‹ä»¶æµæ˜¯ä¸å¯å˜çš„ï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå½“å®ƒè¢«å®šä¹‰ä¹‹åï¼Œä½ ä¸èƒ½å¢åŠ æˆ–ç§»é™¤å®ƒã€‚</p>
<p>ä½†æ˜¯å¦‚æœæˆ‘åªå¯¹x &lt; 250 çš„ç‚¹å‡»äº‹ä»¶æ„Ÿå…´è¶£å‘¢ï¼Ÿé‚£æˆ‘ä»¬èƒ½ä¸èƒ½ä¹Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶æµå°±åƒæˆ‘ä»¬è¿‡æ»¤æ•°ç»„é‚£æ ·å‘¢ï¼Ÿ</p>
<img src="/2016/10/21/è¯‘-ä¸¤åˆ†é’Ÿä»‹ç»Rx/2-FjTqms95LbK_ztsZXiNpoQ.png">
<p></p><p></p>
<font style="font-size:30px;"><center><em>filter( (event) -&gt; event.x &lt; 250 )</em></center></font>

<p></p><p></p>
<img src="/2016/10/21/è¯‘-ä¸¤åˆ†é’Ÿä»‹ç»Rx/1-DvH5Iqul7Nxor7r7AencgA.png">
<p>é‚£ä¹ˆä¸å˜çš„æ•°ç»„å’Œ<code>Observables</code> æœ‰ä»€ä¹ˆä¸åŒå—ï¼Ÿå¹¶ä¸å¤šã€‚ä½ å¯ä»¥å¯¹ä¸¤è€…ä½¿ç”¨<code>map</code>, <code>filter</code>, <code>reduct</code>ã€‚å¯¹äº<code>Observables</code> ä½ è¿˜å¯ä»¥ä½¿ç”¨<code>merge</code>, <code>delay</code>, <code>concat</code>, <code>buffer</code>, <code>distinct</code> , <code>first</code>, <code>last</code>, <code>zip</code>, <code>startWith</code>, <code>widnow</code>, <code>takeUntil</code>, <code>skip</code>, <code>scan</code>, <code>sample</code>, <code>amb</code>, <code>join</code>, <code>flatMap</code>.</p>
<p><strong>æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå¼‚æ­¥çš„ä¸å¯å˜çš„æ•°ç»„ã€‚</strong></p>
<p>Rxåœ¨underscore.jsä¸­æ˜¯ä¸ºäº‹ä»¶æœåŠ¡çš„ã€‚ä½†æ˜¯ç­‰ä¸€ç­‰ï¼Œä»€ä¹ˆæ˜¯äº‹ä»¶ï¼Ÿéš¾é“ä½ appä¸­çš„å¤§éƒ¨åˆ†ä¸œè¥¿ä¸éƒ½æ˜¯äº‹ä»¶å—ï¼Ÿ</p>
<p>äº‹ä»¶â€œç¨‹åºå¼€å§‹â€ï¼Œäº‹ä»¶â€œAPIå“åº”æ¥æ”¶â€ï¼Œäº‹ä»¶â€œé”®ç›˜æŒ‰é”®è¢«ç‚¹å‡»â€ï¼Œäº‹ä»¶â€œè®¾å¤‡ä¼‘çœ â€ï¼Œç­‰ç­‰ã€‚</p>
<p>è™šæ‹Ÿçš„ä»»ä½•ä¸œè¥¿éƒ½èƒ½çœ‹ä½œæ˜¯äº‹ä»¶æµã€‚å®ƒåªæ˜¯å’Œå®ƒçš„æ„æˆä¸åˆé€‚çš„ç»„åˆæœ‰å…³ã€‚</p>
<p>å—¯ï¼Œè¿™å°±æ˜¯ä¸¤åˆ†é’ŸRxã€‚</p>
<blockquote>
<p>Whatâ€™s the difference between an array and events?</p>
</blockquote>
<blockquote>
<p>â€” <a href="https://www.youtube.com/watch?v=FAZJsxcykPs&amp;list=PLfXiENmg6yyU5kEHyo1kYkq7HEzBOoiTT#t=365" target="_blank" rel="noopener">Erik Meijer</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/15/Android-å¯¼å‡ºappä¸­çš„æ•°æ®åº“/" itemprop="url">
                  [Android]å¯¼å‡ºappä¸­çš„æ•°æ®åº“
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-08-15T00:21:14+08:00" content="Aug 15 2016">
              Aug 15 2016
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æœ€è¿‘åšiOSé¡¹ç›®ï¼Œéœ€è¦æŠŠAndroidç«¯çš„æ•°æ®åº“å¯¼å‡ºæ¥æ¯”è¾ƒä¸€ä¸‹ï¼Œè¿™ä¸ªè¿˜æŒºéº»çƒ¦ã€‚</p>
<p>å¦‚æœç”¨æ¨¡æ‹Ÿå™¨çš„è¯ï¼Œå¯ä»¥ç›´æ¥ç”¨DDMSæŸ¥çœ‹æ•°æ®åº“çš„è·¯å¾„ï¼Œç„¶åå¯¼å‡ºï¼Œè¿™æ ·æœ€æ–¹ä¾¿ã€‚ä½†æˆ‘è¿™ä¸ªé¡¹ç›®éœ€è¦ç”¨åˆ°Googleçš„æœåŠ¡ï¼Œ æ¨¡æ‹Ÿå™¨ä¸Šæ— æ³•è¿è¡Œã€‚</p>
<p>å¦‚æœæ˜¯çœŸæœºï¼Œåœ¨ä¸è¶Šç‹±çš„æƒ…å†µä¸‹æ˜¯æ— æ³•æŸ¥çœ‹æ•°æ®åº“è·¯å¾„çš„ï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½ç”¨ä»£ç æŠŠæ•°æ®åº“æ‹·è´åˆ°SDCardä¸Šï¼Œç„¶åç”¨<code>File Manager</code>è¿™ä¸ªappæŠŠæ•°æ®åº“æ–‡ä»¶å¯¼å‡ºæ¥ã€‚</p>
<p>ç”¨ä»£ç æ‹·è´æ–‡ä»¶åˆ°SDCardä¸Šï¼Œéœ€è¦åœ¨<code>AndroidManifest.xml</code>æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹æƒé™ï¼š<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:<span class="attribute">name</span>=<span class="string">"android.permission.MOUNT_UNMOUNT_FILESYSTEMS"</span>/&gt;</span><br><span class="line">&lt;uses-permission android:<span class="attribute">name</span>=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœä½ çš„çœŸæœºæ˜¯6.0ä»¥ä¸Šçš„ç³»ç»Ÿï¼Œè¿˜éœ€è¦åœ¨ç¨‹åºä¸­å‘ç”¨æˆ·è¯·æ±‚æƒé™ï¼š</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">requestPermission</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ContextCompat.checkSelfPermission(<span class="keyword">this</span>,</span><br><span class="line">            android.Manifest.permission.WRITE_EXTERNAL_STORAGE)</span><br><span class="line">            != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Should we show an explanation?</span></span><br><span class="line">        <span class="keyword">if</span> (ActivityCompat.shouldShowRequestPermissionRationale(<span class="keyword">this</span>,</span><br><span class="line">                android.Manifest.permission.WRITE_EXTERNAL_STORAGE)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Show an expanation to the user *asynchronously* -- don't block</span></span><br><span class="line">            <span class="comment">// this thread waiting for the user's response! After the user</span></span><br><span class="line">            <span class="comment">// sees the explanation, try again to request the permission.</span></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// No explanation needed, we can request the permission.</span></span><br><span class="line"></span><br><span class="line">            ActivityCompat.requestPermissions(<span class="keyword">this</span>,</span><br><span class="line">                    <span class="keyword">new</span> String[]&#123;android.Manifest.permission.WRITE_EXTERNAL_STORAGE&#125;,</span><br><span class="line">                    <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// MY_PERMISSIONS_REQUEST_READ_CONTACTS is an</span></span><br><span class="line">            <span class="comment">// app-defined int constant. The callback method gets the</span></span><br><span class="line">            <span class="comment">// result of the request.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        copyDatabase();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> onRequestPermissionsResult(<span class="keyword">int</span> requestCode,</span><br><span class="line">                                           String permissions[], <span class="keyword">int</span>[] grantResults) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (requestCode) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>: &#123;</span><br><span class="line">                <span class="comment">// If request is cancelled, the result arrays are empty.</span></span><br><span class="line">                <span class="keyword">if</span> (grantResults.length &gt; <span class="number">0</span></span><br><span class="line">                        &amp;&amp; grantResults[<span class="number">0</span>] == PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">                    copyDatabase();</span><br><span class="line">                    <span class="comment">// permission was granted, yay! Do the</span></span><br><span class="line">                    <span class="comment">// contacts-related task you need to do.</span></span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// permission denied, boo! Disable the</span></span><br><span class="line">                    <span class="comment">// functionality that depends on this permission.</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// other 'case' lines to check for other</span></span><br><span class="line">            <span class="comment">// permissions this app might request</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œå°†æ•°æ®åº“æ‹·è´åˆ°SDCardã€‚<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> copyDatabase() &#123;</span><br><span class="line">        <span class="keyword">String</span> dbPath = <span class="string">"/data/data/&lt;packageName&gt;/databases/"</span> + DatabaseName;</span><br><span class="line">        <span class="built_in">File</span> file = <span class="keyword">new</span> <span class="built_in">File</span>(dbPath);</span><br><span class="line">        <span class="built_in">if</span> (file.<span class="built_in">exists</span>()) &#123;</span><br><span class="line">            <span class="built_in">File</span> dbCopy = <span class="keyword">new</span> <span class="built_in">File</span>(Environment.getExternalStorageDirectory().getAbsolutePath(), <span class="string">"copy.db"</span>);</span><br><span class="line">            <span class="built_in">try</span> &#123;</span><br><span class="line">                BufferedInputStream in = <span class="keyword">new</span> BufferedInputStream(<span class="keyword">new</span> FileInputStream(dbPath));</span><br><span class="line">                BufferedOutputStream out = <span class="keyword">new</span> BufferedOutputStream(<span class="keyword">new</span> FileOutputStream(dbCopy));</span><br><span class="line">                <span class="keyword">byte</span>[] bb = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                <span class="keyword">int</span> n;</span><br><span class="line">                <span class="built_in">while</span> ((n = in.<span class="built_in">read</span>(bb)) != <span class="number">-1</span>) &#123;</span><br><span class="line">                    out.<span class="built_in">write</span>(bb, <span class="number">0</span>, n);</span><br><span class="line">                &#125;</span><br><span class="line">                out.<span class="built_in">close</span>();</span><br><span class="line">                in.<span class="built_in">close</span>();</span><br><span class="line">            &#125; <span class="built_in">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="built_in">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/18/The-solution-that-the-menu-item-of-Navigation-View-can-t-change-its-background-When-it-is-selected-checked/" itemprop="url">
                  The Solution That the Menu Item of Navigation View Can't Change Its Background When It Is Selected/checked.
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-07-18T10:08:03+08:00" content="Jul 18 2016">
              Jul 18 2016
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Today, when I created a left navigation bar in android app, I met a strange issue. That was I couldnâ€™t appoint a background color for the navigation item when it was selected. Like this:</p>
<img src="/2016/07/18/The-solution-that-the-menu-item-of-Navigation-View-can-t-change-its-background-When-it-is-selected-checked/no-background.gif">
<p> It was annoying, I found many answers on the internet, but they all couldnâ€™t fix my issue.</p>
<p>Most of answers said I should created a selector in drawable folder, like:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@color/primary"</span> <span class="attr">android:state_checked</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@android:color/transparent"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>and set NavigationView like:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app:itemBackground="@drawable/nav_view_item_background"</span><br></pre></td></tr></table></figure>
<p>For me, it is not the correct answer. Though I set the <code>state_checked</code> is true and give it a drawable color, it seems the item is never checked.</p>
<p>For more search, I found the issue was happened with menu item.<br>The original menu file is:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:title</span>=<span class="string">"ä¸»é¢˜"</span> <span class="attr">android:icon</span>=<span class="string">"@drawable/ic_dashboard_grey"</span> <span class="attr">android:id</span>=<span class="string">"@+id/theme"</span> <span class="attr">android:checked</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:title</span>=<span class="string">"èŠ‚ç‚¹"</span> <span class="attr">android:icon</span>=<span class="string">"@drawable/ic_view_agenda_grey"</span> <span class="attr">android:id</span>=<span class="string">"@+id/node"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:title</span>=<span class="string">"å…¶ä»–"</span> <span class="attr">android:id</span>=<span class="string">"@+id/other"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">menu</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:title</span>=<span class="string">"å…³äº"</span> <span class="attr">android:icon</span>=<span class="string">"@drawable/ic_info_grey"</span> <span class="attr">android:id</span>=<span class="string">"@+id/about"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Then I add a tag <code>android:checkable=true</code> to it:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:title</span>=<span class="string">"ä¸»é¢˜"</span> <span class="attr">android:icon</span>=<span class="string">"@drawable/ic_dashboard_grey"</span> <span class="attr">android:id</span>=<span class="string">"@+id/theme"</span> <span class="attr">android:checked</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:checkable</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:title</span>=<span class="string">"èŠ‚ç‚¹"</span> <span class="attr">android:icon</span>=<span class="string">"@drawable/ic_view_agenda_grey"</span> <span class="attr">android:id</span>=<span class="string">"@+id/node"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:checkable</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:title</span>=<span class="string">"å…¶ä»–"</span> <span class="attr">android:id</span>=<span class="string">"@+id/other"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">menu</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:title</span>=<span class="string">"å…³äº"</span> <span class="attr">android:icon</span>=<span class="string">"@drawable/ic_info_grey"</span> <span class="attr">android:id</span>=<span class="string">"@+id/about"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">android:checkable</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Now, the effect is normal.</p>
<img src="/2016/07/18/The-solution-that-the-menu-item-of-Navigation-View-can-t-change-its-background-When-it-is-selected-checked/background.gif">

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="Changwei">
          <p class="site-author-name" itemprop="name">Changwei</p>
          <p class="site-description motion-element" itemprop="description">I develop iOS/Android apps with Swift/Kotlin language.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">71</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">32</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/cwtututu" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/thankforyou" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://cn.linkedin.com/pub/vale-tu/71/527/3a1/" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Linkedin
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.upwork.com/o/profiles/users/_~01eeefc89751549361/" target="_blank" title="Upwork">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Upwork
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.peopleperhour.com/freelancer/changwei/tu/ios-android-developer-parse-layer/986083" target="_blank" title="peopleperhour">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  peopleperhour
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons">
            </a>
          </div>
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Changwei</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
