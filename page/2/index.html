<!doctype html>



  


<html class="theme-next muse use-motion">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="iOS Development, iPhone Development, Android Development, API Development">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1">






<meta name="description" content="I develop iOS/Android apps with Swift/Kotlin language.">
<meta property="og:type" content="website">
<meta property="og:title" content="Changwei&#39;s Blog">
<meta property="og:url" content="http://tuchangwei.github.com/page/2/index.html">
<meta property="og:site_name" content="Changwei&#39;s Blog">
<meta property="og:description" content="I develop iOS/Android apps with Swift/Kotlin language.">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Changwei&#39;s Blog">
<meta name="twitter:description" content="I develop iOS/Android apps with Swift/Kotlin language.">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://tuchangwei.github.com/page/2/">

  <title> Changwei's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Changwei's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">I develop iOS/Android apps with Swift/Kotlin language.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/aboutme" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/06/增加Document-Provider-Extensions时遇到的问题/" itemprop="url">
                  增加Document Provider Extensions时遇到的问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-03-06T09:15:26+08:00" content="Mar 6 2016">
              Mar 6 2016
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近有个需求是在其他的应用中可以选择自己app中的文件，于是接触到了Document Provider Extensions，其实我所遇到的问题在其他Extensions中也可能会遇到，做个总结。</p>
<p>首先这里有几个名词，<code>host app</code>,<code>UIDocumentPickerViewController</code>,<code>Document Provider Extensions</code>,这些名词的关系如下图所示：</p>
<img src="/2016/03/06/增加Document-Provider-Extensions时遇到的问题/QQ20160306-2@2x.png">
<p>也就是说怎么显示<code>Document Provider Extensions</code>菜单，那是host app的事，我们能做的是在container app中开发这个Extension,它就会显示在这个菜单上。不论中间的过程怎样，最终我们只要<strong>通过这个Extension给host app回传一个文件URL</strong>，我们目标就完成了。</p>
<h3 id="问题一，要不要创建File-Provider-Extension"><a href="#问题一，要不要创建File-Provider-Extension" class="headerlink" title="问题一，要不要创建File Provider Extension"></a>问题一，要不要创建File Provider Extension</h3><p>突然蹦出的这个Extension是干嘛的？这个Extension是没有界面的,官方说法是它相当于<code>Document Picker extension</code>的后端。当你在xcode中选择创建<code>Document Provider</code>target时，它会弹一个复选框让你选择要不要同时创建<code>File Provider extension</code>。那要不要同时创建呢？这个要看你的需求了，官方和raywenderlich的资料中都说的比较含糊，我自己的理解是，如果你要分享的数据在<code>Document Picker extension</code>里能拿到，而不是通过URL从container app中取的，那你就没有必要创建<code>File Provider extension</code>。在我这个需求中是不需要通过URL从container app中取数据的，所以我没有创建这个extension。那第二个问题来了。</p>
<h3 id="问题二，Document-Picker-Extension怎样回传给host-app-一个URL"><a href="#问题二，Document-Picker-Extension怎样回传给host-app-一个URL" class="headerlink" title="问题二，Document Picker Extension怎样回传给host app 一个URL"></a>问题二，Document Picker Extension怎样回传给host app 一个URL</h3><p>这里的关键是<code>UIDocumentPickerExtensionViewController</code>中的<code>dismissGrantingAccessToURL</code> 方法。<br>官方的说法是:</p>
<blockquote>
<p>Dismisses the document picker.</p>
<p>Call this method when the user selects a document or destination. This method dismisses the document picker view controller in the host app and triggers the appropriate file transfer. After the transfer is complete, the method passes the provided URL to the host app’s documentPicker:didPickDocumentAtURL: delegate method.</p>
<p>The URL must meet all of the following conditions:</p>
<ul>
<li>Import Document Picker mode. Provide a URL for the selected file. The URL only needs to be accessible by the Document Picker View Controller extension.</li>
</ul>
<p>…</p>
</blockquote>
<p>也就是说只要把date写到<code>Document Picker View Controller extension</code>能访问的地方就行了，那刚好就用公共区域好了。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSURL *containerURL = [fileManager <span class="string">containerURLForSecurityApplicationGroupIdentifier:</span>@<span class="string">"group.xxx"</span>];</span><br></pre></td></tr></table></figure>
<h3 id="第三个问题，啥是公共区。"><a href="#第三个问题，啥是公共区。" class="headerlink" title="第三个问题，啥是公共区。"></a>第三个问题，啥是公共区。</h3><p>这个公共区是你的extensions和container app都能访问的区域，在你的extensions和container app的target的配置中，你会配置一个App Groups，拥有相同App Groups的targets会有一个都可访问的公共区。那么第四个问题也来了。</p>
<h3 id="第四个问题，extensions和container-app共享的数据放在哪？"><a href="#第四个问题，extensions和container-app共享的数据放在哪？" class="headerlink" title="第四个问题，extensions和container app共享的数据放在哪？"></a>第四个问题，extensions和container app共享的数据放在哪？</h3><p>这个问题在第三个问题中已经回答了，但是恰好你用的是MagicalRecord，那么你可以把你的数据库创建在公共区域内，用来共享，相关代码是:</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">NSFileManager</span> *fileManager = [<span class="symbol">NSFileManager</span> defaultManager];</span><br><span class="line"><span class="symbol">NSURL</span> *containerURL = [fileManager containerURLForSecurityApplicationGroupIdentifier:@<span class="string">"group.xxx"</span>];</span><br><span class="line"><span class="symbol">NSURL</span> *storeURL = [containerURL <span class="symbol">URLByAppendingPathComponent</span>:[<span class="symbol">MagicalRecord</span> defaultStoreName]];</span><br><span class="line">[<span class="symbol">MagicalRecord</span> setupCoreDataStackWithAutoMigratingSqliteStoreAtURL:storeURL];</span><br></pre></td></tr></table></figure>
<p>如果你恰好也用了CocoaPads去管理你的第三方代码库,那么第五个问题也粗线了。</p>
<h3 id="第五个问题，怎样用CocoaPads在你的container-app和extensions-中共享第三方代码库"><a href="#第五个问题，怎样用CocoaPads在你的container-app和extensions-中共享第三方代码库" class="headerlink" title="第五个问题，怎样用CocoaPads在你的container app和extensions 中共享第三方代码库?"></a>第五个问题，怎样用CocoaPads在你的container app和extensions 中共享第三方代码库?</h3><p>在你的Podfile中加一行代码，然后pod install就解决了。</p>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">link_with <span class="symbol">'Your</span> container app', <span class="symbol">'Your</span> extension'</span><br></pre></td></tr></table></figure>
<p>上面的代码不是很推荐，你也可以用下面的代码。</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">target <span class="string">'Haystack_V2'</span> <span class="built_in">do</span></span><br><span class="line">    pod <span class="string">'MagicalRecord'</span>, <span class="string">'~&gt; 2.3.0'</span></span><br><span class="line">    pod <span class="string">'SVProgressHUD'</span>, <span class="string">'~&gt; 1.1.3'</span></span><br><span class="line">    pod <span class="string">'SwipeBack'</span>, <span class="string">'~&gt; 1.0'</span></span><br><span class="line"><span class="built_in">end</span></span><br><span class="line">target <span class="string">'Photo Search'</span> <span class="built_in">do</span></span><br><span class="line">    pod <span class="string">'MagicalRecord'</span>, <span class="string">'~&gt; 2.3.0'</span></span><br><span class="line">    pod <span class="string">'SwipeBack'</span>, <span class="string">'~&gt; 1.0'</span></span><br><span class="line"><span class="built_in">end</span></span><br></pre></td></tr></table></figure>
<p>所以你也可能遇到第六个问题，如果你也想在extension中使用SVProgressHUD这个库的话。</p>
<h3 id="第六个问题，在Extensions中使用SVProgressHUD库"><a href="#第六个问题，在Extensions中使用SVProgressHUD库" class="headerlink" title="第六个问题，在Extensions中使用SVProgressHUD库"></a>第六个问题，在Extensions中使用SVProgressHUD库</h3><p>请看下图:</p>
<img src="/2016/03/06/增加Document-Provider-Extensions时遇到的问题/QQ20160306-3@2x.png">
<p>好像就这些了。</p>
<p>Happy coding。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/30/国外威客网站对比/" itemprop="url">
                  国外威客网站对比
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-01-30T11:03:13+08:00" content="Jan 30 2016">
              Jan 30 2016
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <img src="/2016/01/30/国外威客网站对比/QQ20160130-0@2x.png">
<p>转载自:<a href="http://mydevsite.fogtowerdev.com/foreign-witkey-sites.html" target="_blank" rel="noopener">国外威客网站对比</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/03/最近开心的事/" itemprop="url">
                  最近开心的事
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-12-03T11:10:48+08:00" content="Dec 3 2015">
              Dec 3 2015
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近开心的事有两件，一件是<a href="https://www.upwork.com/freelancers/~01eeefc89751549361?viewMode=1" target="_blank" rel="noopener">我的upwork的等级</a>，终于做到了<strong>TOP Rated</strong>。另一件事情是给<a href="https://layer.com" target="_blank" rel="noopener">Layer SDK</a>提的<a href="https://github.com/layerhq/quick-start-ios/pull/10" target="_blank" rel="noopener">bug</a>终于得到确认。</p>
<p>放图：</p>
<img src="/2015/12/03/最近开心的事/QQ20151203-1@2x-copy.png">
<img src="/2015/12/03/最近开心的事/QQ20151203-1@2x.png">
<p>希望自己的自由职业之路越走越好。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/11/12/NSFetchedResultsController查询的对象不属于它的Section/" itemprop="url">
                  NSFetchedResultsController查询的对象不属于它的Section
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-11-12T17:52:20+08:00" content="Nov 12 2015">
              Nov 12 2015
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>当你使用NSFetchedResultsController来显示你数据库里的数据时，你一定被它的方便之处感动的飞起。但是如果你刚刚学会使用这个类，或者第一次用它来显示section，你可能遇到这个坑。</p>
<p>推荐阅读<a href="https://richardwarrender.com/2010/10/core-data-objects-in-wrong-sections/" target="_blank" rel="noopener">这里</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/25/译-实现Twitter-iOS-客户端的UI/" itemprop="url">
                  [译]实现Twitter iOS 客户端的UI
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-10-25T08:22:29+08:00" content="Oct 25 2015">
              Oct 25 2015
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>继续填坑，原文在<a href="https://medium.com/@bitwaker/implementing-the-twitter-ios-app-ui-b5fa32684e06#.lyx30ksr9" target="_blank" rel="noopener">这里</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/24/译-用UIBezierPath做弹性动画/" itemprop="url">
                  [译]用UIBezierPath做弹性动画
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-10-24T08:38:43+08:00" content="Oct 24 2015">
              Oct 24 2015
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>继续填坑，原文在<a href="http://iostuts.io/2015/10/17/elastic-bounce-using-uibezierpath-and-pan-gesture/" target="_blank" rel="noopener">这里</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/19/译-Reset-Checkout-and-Revert/" itemprop="url">
                  [译]Reset, Checkout, and Revert
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-10-19T23:11:30+08:00" content="Oct 19 2015">
              Oct 19 2015
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Git/" itemprop="url" rel="index">
                    <span itemprop="name">Git</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>翻译自<a href="https://www.atlassian.com/git/tutorials/resetting-checking-out-and-reverting/file-level-operations" target="_blank" rel="noopener">这篇文章</a></p>
<p><code>git reset</code>, <code>get checkout</code> 和 <code>git revert</code>命令是你Git工具箱中最有用的几个工具。它们可以让你在仓库中撤销某些改变，前两个命令也可以用来处理提交或者单个的文件。</p>
<p>因为他们很相似，所以在特定的开发场景下，使用哪种命令就很容易混淆。在这篇文章中，我们将比较这三个命令常见的配置，希望你能自行的用这些命令去驾驭你的仓库。</p>
<img src="/2015/10/19/译-Reset-Checkout-and-Revert/01.svg">
<p>这帮助我们去想每一个命令在这三个Git仓库主要组件（工作区，快照，提交历史）中的作用。当你读这篇文章的时候，时常回想这些组件。</p>
<h1 id="提交层面的操作"><a href="#提交层面的操作" class="headerlink" title="提交层面的操作"></a>提交层面的操作</h1><p>你传给 <code>git reset</code> 和 <code>git checkout</code> 的参数决定了它们的作用域。当你不包含一个文件路径做参数时，它们作用于整个提交。这是我们在这一章节将要介绍的内容。注意 <code>git revert</code>并没有文件层面对应的内容。</p>
<h2 id="Reset"><a href="#Reset" class="headerlink" title="Reset"></a>Reset</h2><p>在提交层面，重设是移动分支末端到另一个不同的提交的一种方式。这能用来从当前分支移走一些提交。比如，下面的命令把 hotfix 分支向后移动两个提交。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout hotfix</span><br><span class="line">git <span class="keyword">reset</span> <span class="keyword">HEAD</span>~<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>这两个位于hotfix末端的提交现在正在摇摆，也就是说，它们将会在Git下次执行垃圾收集的时候删除。换言之，你可以说你想要抛弃这些提交。下图看起来会比较直观：</p>
<img src="/2015/10/19/译-Reset-Checkout-and-Revert/02.svg">
<p><code>git reset</code> 的使用是一个简单的方式去撤销还未分享给他人的更改。这是你将要用到的命令当你已经开始在一个feature分支上工作，然后你发现自己一直在想，“卧槽，我在干啥？我应该从头开始。”</p>
<p>另外，移动当前分支时，你也可以通过传递一下的某个标识，让 <code>git reset</code> 去修改快照区和／或工作区。</p>
<p>1, –soft － 快照区和工作区不会被修改。<br>2, –mixed －快照区将会更新到特定的提交，但是工作区不会受影响。这是默认选项。<br>3, –hard －快照区和工作区都会更新到特定的提交。</p>
<p>当定义这个 <code>git reset</code> 操作的作用域时，它将会容易去思考这些模式。</p>
<img src="/2015/10/19/译-Reset-Checkout-and-Revert/03.svg">
<p>这些标识常常和 <code>HEAD</code> 参数一起使用。比如 <code>git reset --mixed HEAD</code> 清空快照区，但是保留工作区的更改。另一方面，如果你想完全抛弃所有未提交的更改，你可以使用 <code>git reset --hard HEAD</code>. 这是 <code>git reset</code> 最常用两种使用方式。</p>
<p>当传入的提交是 <code>HEAD</code> 以外的参数时，一定到小心，因为这将会重写当前分支的历史。正如在<a href="我并不知道地址是啥">The Golden Rule of Rebasing</a>中提到的，当工作在一个公共分支时，这将是一个大问题。</p>
<h2 id="Checkout"><a href="#Checkout" class="headerlink" title="Checkout"></a>Checkout</h2><p>到现在为止，你应该比较熟悉 <code>git checkout</code> 的提交层面。当传递一个分支名称时，它让你在不同分支间切换。</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">git checkout hotfix</span></span><br></pre></td></tr></table></figure>
<p>本质上讲，这个命令所做的就是移动HEAD到另一个分支，并且更新工作区使之于其匹配。因为这有重写本地更改的风险，Git强制你提交或者暂存工作区里的任何更改，以防这些更改在checkout操作中丢失。并不像 <code>git reset</code> 那样，<code>git checkout</code> 并不会向前后移动任何分支。</p>
<img src="/2015/10/19/译-Reset-Checkout-and-Revert/04.svg">
<p>你也可以检出任何提交通过传递一个提交引用而不是分支。这确实也像检出一个分支那样：它移动这个HEAD引用到特定的提交。比如，下面的命令将检出当前提交的父父层。</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout HEAD~<span class="number">2</span></span><br></pre></td></tr></table></figure>
<img src="/2015/10/19/译-Reset-Checkout-and-Revert/05.svg">
<p>这对于快速查看项目中老的版本十分有用。但是，由于对于当前的HEAD并没有指定分支引用，这将把你放进一个临时的HEAD状态。如果此时你增加新的提交，那就会比较危险，因为当你切换到另一个分支之后，你就没有办法再找到它们。因为这个原因，在你增加新的提交到一个暂存的HEAD状态前，你应该新建一个新分支。</p>
<h2 id="Revert"><a href="#Revert" class="headerlink" title="Revert"></a>Revert</h2><p>恢复原状通过提交一个新的提交去撤销一个提交。这是撤销改变的一个安全的方式，因为它不会改变或者重写提交的历史。比如，下面的命令将会找出最后两个提交的改变，创建新的提交去撤销那些改变，并且把这个新的提交钉在这个项目上。</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">git</span> checkout hotfix</span><br><span class="line"><span class="symbol">git</span> <span class="keyword">revert </span>HEAD~<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>下图更直观：</p>
<img src="/2015/10/19/译-Reset-Checkout-and-Revert/06.svg">
<p>和 <code>git reset</code> 做比较，这个命令并不修改已存在的提交历史。因为这个原因，<code>git revert</code> 应该在公共分支上使用来撤销更改，<code>git reset</code> 应该在个人分支上使用来撤销更改。</p>
<p>你也可以认为 <code>git revert</code> 是撤销已提交更改的工具，而 <code>git reset HEAD</code> 是撤销未提交更改的工具。</p>
<p>像 <code>git checkout</code>，<code>git revert</code> 都有重写工作区文件的风险，所以当你进行这些操作时，都会被要求提交或缓存更改。</p>
<h1 id="文件层面的操作"><a href="#文件层面的操作" class="headerlink" title="文件层面的操作"></a>文件层面的操作</h1><p>这个 <code>git reset</code> 和 <code>git checkout</code> 命令也允许一个可选的文件路径作为参数。这将修改它们的行为。代替操作整个快照区，这种方式将会限制它们操作在单个文件中。</p>
<h2 id="Reset-1"><a href="#Reset-1" class="headerlink" title="Reset"></a>Reset</h2><p>当传递一个文件路径调用时， <code>git reset</code> 更新这个快照区去匹配特定提交的版本。比如，下面命令将会取得foo.py的倒数第二次提交的版本，并且在下一次提交时存储它。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">reset</span> <span class="keyword">HEAD</span>~<span class="number">2</span> foo.py</span><br></pre></td></tr></table></figure>
<p>和提交层面的 <code>git reset</code> 一样，和HEAD搭配使用是比较常见的。<code>git reset HEAD foo.py</code> 将会取消暂存foo.py. 但是它所包含的更改在工作区中还是可见的。</p>
<img src="/2015/10/19/译-Reset-Checkout-and-Revert/07.svg">
<p>这个 <code>--soft</code>, <code>--mixed</code> 和 <code>--hard</code> 标识对文件层面的 <code>git reset</code> 并没有什么卵用。因为快照区一直在更新，而工作区从来不更新。</p>
<h2 id="Checkout-1"><a href="#Checkout-1" class="headerlink" title="Checkout"></a>Checkout</h2><p>检出一个文件和使用<code>git reset</code>后面带一个文件路径是类似的，唯一的不同是，它更新的是工作区而不是暂存区。并不像提交等级的版本那样，这个命令并不会移动<code>HEAD</code>的引用，这意味着你将不会切换分支。</p>
<img src="/2015/10/19/译-Reset-Checkout-and-Revert/08.svg">
<p>比如，下面的命令将会使在工作区里的foo.py文件匹配倒数第二次提交的这个文件。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">git</span> <span class="selector-tag">checkout</span> <span class="selector-tag">HEAD</span>~2 <span class="selector-tag">foo</span><span class="selector-class">.py</span></span><br></pre></td></tr></table></figure>
<p>像提交等级的<code>git checkout</code>命令一样，这被用来检查一个项目的老的版本——但是他的作用范围是指定的文件。</p>
<p>如果你暂存和提交这个检出的文件，这还会有回退到老文件的作用。注意这将移除所有随后的改变。但是<code>git revert</code>命令仅仅撤销某个指定的提交的改变。</p>
<p>像<code>git reset</code>一样，这个命令常常和HEAD一起使用。比如，<code>git checkout HEAD foo.py</code>有丢弃未暂存的更改的作用。这有点类似<code>git reset HEAD --hard</code>,但是它操作的是指定的文件。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>你现在应该拥有所有工具去撤销改变了。<code>git reset</code>,<code>git checkout</code>,<code>git revert</code>命令可能是让人迷惑的，但是当你想一想它们对工作区，暂存区和提交历史的作用，对于那种命令适合哪种开发任务将会变的容易区别。</p>
<p>下面的表格总结一些常用的用例，确保把这个手册放在手边，因为在你的Git生涯中，无疑你会用到它们中的一个或多个。</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Scope</th>
<th>Common use cases</th>
</tr>
</thead>
<tbody>
<tr>
<td>git reset</td>
<td>Commit-level</td>
<td>Discard commits in a private branch or throw away uncommited changes</td>
<td></td>
</tr>
<tr>
<td>git reset</td>
<td>File-level</td>
<td>Unstage a file</td>
<td></td>
</tr>
<tr>
<td>git checkout</td>
<td>Commit-level</td>
<td>Switch between branches or inspect old snapshots</td>
<td></td>
</tr>
<tr>
<td>git checkout</td>
<td>File-level</td>
<td>Discard changes in the working directory</td>
<td></td>
</tr>
<tr>
<td>git revert</td>
<td>Commit-level</td>
<td>Undo commits in a public branch</td>
<td></td>
</tr>
<tr>
<td>git revert</td>
<td>File-level</td>
<td>(N/A)</td>
<td></td>
</tr>
</tbody>
</table>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/19/HEXO-重装记录/" itemprop="url">
                  HEXO 重装记录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-10-19T21:48:20+08:00" content="Oct 19 2015">
              Oct 19 2015
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>OSX EL Capitan 发布后神奇的是我的电脑无法正常升级，无奈重新做了安装盘重装了系统。这一装不要紧，最近写的博文都无法发表了。查看了hexo的版本号，发现我使用的是2.8.3的版本，而我重装的hexo是3.1.1的版本，看来不得不升级了。</p>
<p>在原Blog目录下折腾是没戏了。那么第一步是: 新建Blog文件夹，初始化Blog。</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">mkdir</span> <span class="keyword">Blog</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">hexo </span>init <span class="keyword">Blog</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">cd </span><span class="keyword">Blog</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">npm </span>install</span><br></pre></td></tr></table></figure>
<p>第二步是覆盖<code>_config.yml</code>文件，这里面有一点要注意的是老的deploy标签下的type是github，新的改成了git。</p>
<p>老的：<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">deploy:</span></span><br><span class="line"><span class="symbol">  type:</span> github</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure></p>
<p>新的：<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">deploy:</span></span><br><span class="line"><span class="symbol">  type:</span> git</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure></p>
<p>第三步是拷贝你用到的module到node_modules目录下，我这里用到了一个<code>hexo-tag-asset-res</code>库，是用来保持首页和详细页中的图片连接指向同一个资源。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cp</span> -R ../Blog_HEXO/node_modules/hexo-<span class="keyword">tag</span>-asset-<span class="keyword">res</span> node_modules</span><br></pre></td></tr></table></figure>
<p>第四步是覆盖source和themes文件夹，比较幸运的是我选的主题在新的框架下还能用，似乎更酷了。</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">cp</span></span> -R ../Blog_HEXO/source .</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">cp</span></span> -R ../Blog_HEXO/themes .</span><br></pre></td></tr></table></figure>
<p>OK, 这时候<code>hexo g</code> 一下，再<code>hexo s</code> 一下，打开浏览器输入<code>http://0.0.0.0:4000/</code>, 很棒！所有的都没有丢失，还给你多加了一篇Hello World。</p>
<p>OK，开始发布到Github，于是你:</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hexo d</span></span><br></pre></td></tr></table></figure>
<p>于是终端告诉你…</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ERROR </span>Deployer not found: git</span><br></pre></td></tr></table></figure>
<p>别担心，不会前功尽弃的，只要你:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> hexo-deployer-git <span class="comment">--save</span></span><br></pre></td></tr></table></figure>
<p>Enjoy :)</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/09/25/-译-如何用Node-js实现SSL-TLS/" itemprop="url">
                  [译]如何用Node.js实现SSL/TLS
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-09-25T21:56:51+08:00" content="Sep 25 2015">
              Sep 25 2015
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Node-js/" itemprop="url" rel="index">
                    <span itemprop="name">Node.js</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近iOS9发布，强制App使用HTTPS传输,做为一个入坑多年的iOS程序员，还真是不了解这其中的来龙去脉，刚好订阅的Node.js周报中推送了这篇<a href="http://www.sitepoint.com/how-to-use-ssltls-with-node-js/" target="_blank" rel="noopener">文章</a>,赶紧翻译过来，既搞清了HTTPS又学习了Node.js，一举两得。</p>
<hr>
<p>使用HTTPS正在变的越来越普遍，因此我们应该知道怎么在Node.js程序中实现SSL/TSL——不论是为了访问HTTPS资源还是为了提供加密的资源。HTTPS到底是什么意思呢？它暗示了什么？有什么限制和约束？我们将试着为所有的这些问题找到答案。</p>
<p>另外，我们不应该仅仅通过提供HTTPS来保护我们的客户端，而且我们也应该严格要求来自服务器的是加密过的连接。我们将会看到激活SSL/TLS层的可能性的存在，即使默认情况下不能激活。让我们先来浏览一下HTTPS的当前情况。</p>
<h1 id="HTTPS-Everywhere"><a href="#HTTPS-Everywhere" class="headerlink" title="HTTPS Everywhere"></a>HTTPS Everywhere</h1><p>在2015年2月17日，HTTP/2协议被IESG许可作为推荐的标准发布。这是一个大的里程碑。现在我们可以更新我们的服务器去使用HTTP/2。一个重要的方面是它与HTTP1.1和握手机制的向后的兼容性。虽然这个标准并没有指明要强制加密，但大部分浏览器将仅仅支持TLS之上的HTTP/2协议。这给了HTTPS另一方面的促进。最终，HTTPS everywhere!</p>
<p>那我们的协议栈看起来是怎样的呢？从一个在浏览器中跑的网站的透视来看，我们大致有下面的一些层到达IP层。</p>
<ol>
<li>用户浏览器</li>
<li>HTTP</li>
<li>SSL/TLS</li>
<li>TCP</li>
<li>IP</li>
</ol>
<p>对比SSL/TLS顶端的HTTP协议来说，HTTPS啥也不多。因此，所有对于HTTP的规则仍然适用。那额外的层给了我们什么呢？给了很多好处。我们通过拥有Keys和证书来获得授权。当连接以一种不对称的加密时，还有某种隐私和机密被保护。最后但不仅仅还有数据的真实性也会得到保护，比如，那些传输完成的数据在传输过程中是不能被改变的。</p>
<p>其中一个最普遍的错误观念是使用SSL/TLS需要太多的资源并且会拖慢服务器的速度。这无异是错误的。我们也不需要任何特制的拥有密码单元的硬件。甚至对于Google来说，SSL/TLS层的消耗也小于百分之一的CPU的加载。更进一步的讲，HTTPS的网络开支会低于HTTP的百分之二。总而言之，如果因为一点网络开支而放弃HTTPS，这是没有道理的。</p>
<img src="/2015/09/25/-译-如何用Node-js实现SSL-TLS/1442392075istlsfastyet.png">
<p>最新的版本是TLS1.2（目前1.3版本作为工作草案是可用的）。TLS是SSL的继承者，在最新发布的SSL3.0中可以使用。从SSL到TLS的改变杜绝的互通性。但是基本的流程是不变的。我们有三种不同的加密途径。第一个是证书链公钥基础结构，第二个是提供公钥密码作为Key交换。最后，第三种是对称。这里我们对于数据传输有密码逻辑。</p>
<p>我们可以使用很多哈希算法，比如MD5，SHA1，SHA256. MD5已经被降级了，我们不应该使用它了。SHA1仍然是可接受的，但可能不久后也会被降级。比较好的是SHA256，它当前拥有更多的用户。用SHA256有一个问题是老的系统是否支持它，比如，在Window XP上，SHA256只能通过安装Service Pack 3才能使用。</p>
<p>HTTPS也正在获得更多客户端的关注。隐私和安全问题一直存在，但随着在线访问数据和服务人数日益增长都越来越关受注。一个有用的浏览器插件是 <code>HTTPS Everywhere</code>,它可以加密我们与大多数网站之间的交流。</p>
<img src="/2015/09/25/-译-如何用Node-js实现SSL-TLS/1442392093everywhere.png">
<p>这个插件的作者认识到很多网站仅仅有一部分提供了HTTPS功能。这个插件允许我们重新请求这些只有部分支持HTTPS的网站。</p>
<p>可选的，我们也可以同时屏蔽HTTP请求（如上面的截图所示）</p>
<h1 id="Basic-Communication"><a href="#Basic-Communication" class="headerlink" title="Basic Communication"></a>Basic Communication</h1><p>这个证书的认证过程包括验证证书签名的有效性和过期时间。此外我们还要验证它链接到可信任的根证书。最后，我们需要去检测它是否已经被撤销。</p>
<p>HTTPS握手的流程图像下图一样。我们从客户端的初始化开始，伴随其后的是一条带有证书和Key交换的信息。在服务器返回完整的包之后，客户端开始Key交换和密码详情的传输。这时，客户端已经完成。最后服务器确认对密码详情的挑选，然后关闭握手。</p>
<img src="/2015/09/25/-译-如何用Node-js实现SSL-TLS/1442392132sequence.png">
<p>这整个流程被触发独立于HTTP。如果我们决定使用HTTPS，仅仅改变的是对Socket的处理。客户端仍然发起的是HTTP请求，但是socket将会执行前面描叙的握手协议和数据加密。</p>
<p>所以，在Node.js中，什么包能处理SSL／TLS呢？下面我们将会简单的讲到三种标准的包。</p>
<h2 id="ssl-root-cas"><a href="#ssl-root-cas" class="headerlink" title="ssl-root-cas"></a>ssl-root-cas</h2><p>当我们在处理自定义的或过期的证书遇到问题时，<code>ssl-root-cas</code>能够帮助我们。当许可证不可用时，它也很有帮助。</p>
<p>归结起来，大部分时间会用到下面的命令。这个<code>inject</code>方法修改<code>https.globalAgent.options.ca</code> 去包含一系列的证书。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">require</span>(<span class="string">'ssl-root-cas'</span>)<span class="selector-class">.inject</span>();</span><br></pre></td></tr></table></figure>
<p>但是，有时也可能需要增加本地自定义的证书。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">require</span>(<span class="string">'ssl-root-cas'</span>)<span class="selector-class">.addFile</span>(<span class="string">'my-cert.crt'</span>);</span><br></pre></td></tr></table></figure>
<p>从 <code>ssl-root-cas</code> 模块返回的这个对象是可串的，因此能够用来增加多个文件或注入多个标准文件在一次调用中。</p>
<h2 id="https"><a href="#https" class="headerlink" title="https"></a>https</h2><p>类似于<code>http</code>,我们可以使用<code>https</code>. 这个主要的区别是如果我们需要发布我们的服务器，我们需要提供一个key。这将会在下一章节讨论。</p>
<p>现在我们仅仅看一下我们怎么创建一个HTTPS请求。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var https = <span class="built_in">require</span>(<span class="string">'https'</span>);</span><br><span class="line"></span><br><span class="line">https.get(<span class="string">'https://www.amazon.com/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(res)</span></span> &#123;</span><br><span class="line">   console.<span class="built_in">log</span>(<span class="string">'statusCode: '</span>, res.statusCode);</span><br><span class="line"></span><br><span class="line">   res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span></span> &#123;</span><br><span class="line">      process.<span class="built_in">stdout</span>.<span class="built_in">write</span>(d);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>基本上，<code>https</code>提供和<code>http</code>相同的功能。但是在最上层增加了SSL/TLS层。API大部分是相同的。</p>
<h2 id="tls"><a href="#tls" class="headerlink" title="tls"></a>tls</h2><p><code>tls</code>模块需要<code>openssl</code>工具包，下一章节将会讨论<code>openssl</code>工具包。这个模块为加密的流传输提供了SSL/TLS。本质上，<code>https</code>也使用了<code>tls</code>。所以，使用<code>tls</code>API时感觉会和<code>http</code>模块的方法相关就不是啥惊奇的事了。</p>
<p>下面简单的代码创建了一个在8000端口监听连接的服务器，进来的连接讲接收一个加密后的数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tls = <span class="built_in">require</span>(<span class="string">'tls'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">   key  : fs.readFileSync(<span class="string">'private.key'</span>),</span><br><span class="line">   cert : fs.readFileSync(<span class="string">'public.cert'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = tls.createServer(options, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">   res.write(<span class="string">'Hello World!'</span>);</span><br><span class="line">   res.pipe(res);</span><br><span class="line">&#125;).listen(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure>
<p>类似的，我们也可以连接这样一个服务器。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tls = <span class="built_in">require</span>(<span class="string">'tls'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">   key  : fs.readFileSync(<span class="string">'private.key'</span>),</span><br><span class="line">   cert : fs.readFileSync(<span class="string">'public.cert'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> client = tls.connect(<span class="number">8000</span>, options, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(client.authorized ? <span class="string">'Authorized'</span> : <span class="string">'Not authorized'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">client.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">   client.end();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>现在，我们应该看一下怎样生成我们自己的key和证书文件。</p>
<h1 id="Generating-Certificates"><a href="#Generating-Certificates" class="headerlink" title="Generating Certificates"></a>Generating Certificates</h1><p>从技术的角度上来看，证书并不是强制的。不过，由于网络的开放性，如果不增加证书，中间人攻击就会变得太平常。因此，一个被可信赖证书认证（CA）的证书是按需求而定的。CA确保了证书的持有者就是这个证书的创建者。</p>
<p>下面，我们会使用<code>openssl</code>工具。这个程序将会给我们用RSA加密生成私有Key的能力。我们也能够发起一个证书签名的请求（CSR）。更进一步的，这个OpenSSL项目的核心库还能生成自签名的证书。这些证书可以用来做测试，它们不应该公开使用。</p>
<p>第一步是创建一个私有的Key。作为一个例子，我们可以使用下面的命令，生成一个叫server.enc.key的文件。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -des3 -out server<span class="selector-class">.enc</span><span class="selector-class">.key</span> <span class="number">1024</span></span><br></pre></td></tr></table></figure>
<p>这个生成的RSA Key是一个1024字节的用三倍DES加密的key。这个文件是人类可读的。作为一个轻量的变形，我们也可以省略掉<code>-des3</code>选项，并且改变加密的强度，比如<code>2048</code>。虽然在这个例子中我们使用了1024字节的key，但是对于真是的Key，我们应该最少使用2048字节的长度。</p>
<p>一旦我们拥有一个生成的Key，我们需要发起一个证书签名的请求。一个证书可以用如下的命令生成：</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -<span class="keyword">new</span> -key <span class="keyword">server</span>.enc.key -out <span class="keyword">server</span>.csr</span><br></pre></td></tr></table></figure>
<p>生成的CSR存在于server.csr文件中。我们需要对这个文件进行自签名。</p>
<p>到这时，当使用server.enc.key文件中的key时，我们需要输入一个密码。由于我们仅在内部使用这个证书，所以我们可以移除密码保护。移除3倍的DES加密用下面的命令。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa -<span class="keyword">in</span> server<span class="selector-class">.enc</span><span class="selector-class">.key</span> -out server.key</span><br></pre></td></tr></table></figure>
<p>现在这个原始加密的server.enc.key文件被转换成非加密的文件server.key。</p>
<p>最后，我们要对这个证书进行自签名。自签名的证书将会在浏览器中生成一个错误。这是因为这个自签名的证书的权威机构是未知的，因此不被信任。为了生成一个临时的证书server.crt，我们需要发送下面的命令。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days <span class="number">365</span> -<span class="keyword">in</span> server<span class="selector-class">.csr</span> -signkey server<span class="selector-class">.key</span> -out server.crt</span><br></pre></td></tr></table></figure>
<p>这个证书将会在发出这个命令的365天内过期。</p>
<h1 id="Integration-with-Express"><a href="#Integration-with-Express" class="headerlink" title="Integration with Express"></a>Integration with Express</h1><p>使用HTTPS代替HTTP是可能的也是被期望的。我们将开始使用Express编写一个小的Node.js应用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   res.send(<span class="string">'Hello World!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.createServer(app).listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'Started!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>启动HTTPS我们需要做啥更改呢？显然，我们需要导入一个不同的包。最后我们也需要提供正确的Key／证书。所有文件的内容需要被展现，它们被传递到<code>https</code>包的<code>createServer</code>方法。</p>
<p>让我们用SSL/TLS重写我们的Express例子:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)();</span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">   key  : fs.readFileSync(<span class="string">'server.key'</span>),</span><br><span class="line">   cert : fs.readFileSync(<span class="string">'server.crt'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   res.send(<span class="string">'Hello World!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">https.createServer(options, app).listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'Started!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>就是如此简单！在上面的例子中，我们假设key和证书都位于工作目录中。这仍然有很大的提升空间。一个可能性是放这段代码到创建server的module中。这个module将会根据选择不同的协议来选择正确的包。另外，这个端口，key和证书应该驱逐到一个<code>settongs</code>对象中。</p>
<p>一个简单的实现可能看起来如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setup</span> (<span class="params">ssl</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (ssl &amp;&amp; ssl.active) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">         key  : fs.readFileSync(ssl.key),</span><br><span class="line">         cert : fs.readFileSync(ssl.certificate)</span><br><span class="line">      &#125;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">start</span> (<span class="params">app, options</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (options)</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">'https'</span>).createServer(options, app);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">'http'</span>).createServer(app);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">   create: <span class="function"><span class="keyword">function</span> (<span class="params">settings, app, cb</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> options = setup(settings.ssl);</span><br><span class="line">      <span class="keyword">return</span> start(app, options).listen(settings.port, cb);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>关键的地方是<code>settings</code>中的<code>ssl</code>对象，如果这个对象存在并且有个叫<code>active</code>的参数设置为true，那么我们将会用提供的Key／证书启动SSL／TLS。</p>
<h1 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h1><p>在2015年，没有理由再去忽视HTTPS了。未来的方向是清晰可见的——到处都是HTTPS！在Node.js中， 我们有很多选择去管理SSL／TLS。我们可以发布我们HTTPS的网站，我们可以对加密的网站发起请求，我们也能授权哪怕不被信任的证书。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/09/15/Helpful-JS-Resources-Recommanded-by-Code-School/" itemprop="url">
                  Helpful JS Resources Recommanded by Code School
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-09-15T20:44:39+08:00" content="Sep 15 2015">
              Sep 15 2015
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Javascript/" itemprop="url" rel="index">
                    <span itemprop="name">Javascript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>完成了code school中的JS课程部分，纪录一些老师推荐的网站</p>
<ul>
<li><a href="http://jstherightway.org/" target="_blank" rel="noopener">JavaScript: The Right Way</a></li>
<li><a href="http://javascript.crockford.com/code.html" target="_blank" rel="noopener">Code Conventions for JavaScript</a></li>
<li><a href="http://flippinawesome.org/2013/12/23/45-useful-javascript-tips-tricks-and-best-practices/" target="_blank" rel="noopener">45 Useful JavaScript Tips and Tricks</a></li>
<li><a href="http://www.thinkful.com/learn/javascript-best-practices-1/" target="_blank" rel="noopener">Thinkful: Best Practices 1 and 2</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="Changwei">
          <p class="site-author-name" itemprop="name">Changwei</p>
          <p class="site-description motion-element" itemprop="description">I develop iOS/Android apps with Swift/Kotlin language.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">71</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">32</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/cwtututu" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/thankforyou" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://cn.linkedin.com/pub/vale-tu/71/527/3a1/" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Linkedin
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.upwork.com/o/profiles/users/_~01eeefc89751549361/" target="_blank" title="Upwork">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Upwork
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.peopleperhour.com/freelancer/changwei/tu/ios-android-developer-parse-layer/986083" target="_blank" title="peopleperhour">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  peopleperhour
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons">
            </a>
          </div>
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Changwei</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
