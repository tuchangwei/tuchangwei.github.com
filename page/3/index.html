<!doctype html>



  


<html class="theme-next muse use-motion">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="iOS Development, iPhone Development, Android Development, API Development">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1">






<meta name="description" content="I develop iOS/Android apps with Swift/Kotlin language.">
<meta property="og:type" content="website">
<meta property="og:title" content="Changwei&#39;s Blog">
<meta property="og:url" content="http://tuchangwei.github.com/page/3/index.html">
<meta property="og:site_name" content="Changwei&#39;s Blog">
<meta property="og:description" content="I develop iOS/Android apps with Swift/Kotlin language.">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Changwei&#39;s Blog">
<meta name="twitter:description" content="I develop iOS/Android apps with Swift/Kotlin language.">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://tuchangwei.github.com/page/3/">

  <title> Changwei's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Changwei's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">I develop iOS/Android apps with Swift/Kotlin language.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/aboutme" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/09/25/-译-如何用Node-js实现SSL-TLS/" itemprop="url">
                  [译]如何用Node.js实现SSL/TLS
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-09-25T21:56:51+08:00" content="Sep 25 2015">
              Sep 25 2015
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Node-js/" itemprop="url" rel="index">
                    <span itemprop="name">Node.js</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近iOS9发布，强制App使用HTTPS传输,做为一个入坑多年的iOS程序员，还真是不了解这其中的来龙去脉，刚好订阅的Node.js周报中推送了这篇<a href="http://www.sitepoint.com/how-to-use-ssltls-with-node-js/" target="_blank" rel="noopener">文章</a>,赶紧翻译过来，既搞清了HTTPS又学习了Node.js，一举两得。</p>
<hr>
<p>使用HTTPS正在变的越来越普遍，因此我们应该知道怎么在Node.js程序中实现SSL/TSL——不论是为了访问HTTPS资源还是为了提供加密的资源。HTTPS到底是什么意思呢？它暗示了什么？有什么限制和约束？我们将试着为所有的这些问题找到答案。</p>
<p>另外，我们不应该仅仅通过提供HTTPS来保护我们的客户端，而且我们也应该严格要求来自服务器的是加密过的连接。我们将会看到激活SSL/TLS层的可能性的存在，即使默认情况下不能激活。让我们先来浏览一下HTTPS的当前情况。</p>
<h1 id="HTTPS-Everywhere"><a href="#HTTPS-Everywhere" class="headerlink" title="HTTPS Everywhere"></a>HTTPS Everywhere</h1><p>在2015年2月17日，HTTP/2协议被IESG许可作为推荐的标准发布。这是一个大的里程碑。现在我们可以更新我们的服务器去使用HTTP/2。一个重要的方面是它与HTTP1.1和握手机制的向后的兼容性。虽然这个标准并没有指明要强制加密，但大部分浏览器将仅仅支持TLS之上的HTTP/2协议。这给了HTTPS另一方面的促进。最终，HTTPS everywhere!</p>
<p>那我们的协议栈看起来是怎样的呢？从一个在浏览器中跑的网站的透视来看，我们大致有下面的一些层到达IP层。</p>
<ol>
<li>用户浏览器</li>
<li>HTTP</li>
<li>SSL/TLS</li>
<li>TCP</li>
<li>IP</li>
</ol>
<p>对比SSL/TLS顶端的HTTP协议来说，HTTPS啥也不多。因此，所有对于HTTP的规则仍然适用。那额外的层给了我们什么呢？给了很多好处。我们通过拥有Keys和证书来获得授权。当连接以一种不对称的加密时，还有某种隐私和机密被保护。最后但不仅仅还有数据的真实性也会得到保护，比如，那些传输完成的数据在传输过程中是不能被改变的。</p>
<p>其中一个最普遍的错误观念是使用SSL/TLS需要太多的资源并且会拖慢服务器的速度。这无异是错误的。我们也不需要任何特制的拥有密码单元的硬件。甚至对于Google来说，SSL/TLS层的消耗也小于百分之一的CPU的加载。更进一步的讲，HTTPS的网络开支会低于HTTP的百分之二。总而言之，如果因为一点网络开支而放弃HTTPS，这是没有道理的。</p>
<img src="/2015/09/25/-译-如何用Node-js实现SSL-TLS/1442392075istlsfastyet.png">
<p>最新的版本是TLS1.2（目前1.3版本作为工作草案是可用的）。TLS是SSL的继承者，在最新发布的SSL3.0中可以使用。从SSL到TLS的改变杜绝的互通性。但是基本的流程是不变的。我们有三种不同的加密途径。第一个是证书链公钥基础结构，第二个是提供公钥密码作为Key交换。最后，第三种是对称。这里我们对于数据传输有密码逻辑。</p>
<p>我们可以使用很多哈希算法，比如MD5，SHA1，SHA256. MD5已经被降级了，我们不应该使用它了。SHA1仍然是可接受的，但可能不久后也会被降级。比较好的是SHA256，它当前拥有更多的用户。用SHA256有一个问题是老的系统是否支持它，比如，在Window XP上，SHA256只能通过安装Service Pack 3才能使用。</p>
<p>HTTPS也正在获得更多客户端的关注。隐私和安全问题一直存在，但随着在线访问数据和服务人数日益增长都越来越关受注。一个有用的浏览器插件是 <code>HTTPS Everywhere</code>,它可以加密我们与大多数网站之间的交流。</p>
<img src="/2015/09/25/-译-如何用Node-js实现SSL-TLS/1442392093everywhere.png">
<p>这个插件的作者认识到很多网站仅仅有一部分提供了HTTPS功能。这个插件允许我们重新请求这些只有部分支持HTTPS的网站。</p>
<p>可选的，我们也可以同时屏蔽HTTP请求（如上面的截图所示）</p>
<h1 id="Basic-Communication"><a href="#Basic-Communication" class="headerlink" title="Basic Communication"></a>Basic Communication</h1><p>这个证书的认证过程包括验证证书签名的有效性和过期时间。此外我们还要验证它链接到可信任的根证书。最后，我们需要去检测它是否已经被撤销。</p>
<p>HTTPS握手的流程图像下图一样。我们从客户端的初始化开始，伴随其后的是一条带有证书和Key交换的信息。在服务器返回完整的包之后，客户端开始Key交换和密码详情的传输。这时，客户端已经完成。最后服务器确认对密码详情的挑选，然后关闭握手。</p>
<img src="/2015/09/25/-译-如何用Node-js实现SSL-TLS/1442392132sequence.png">
<p>这整个流程被触发独立于HTTP。如果我们决定使用HTTPS，仅仅改变的是对Socket的处理。客户端仍然发起的是HTTP请求，但是socket将会执行前面描叙的握手协议和数据加密。</p>
<p>所以，在Node.js中，什么包能处理SSL／TLS呢？下面我们将会简单的讲到三种标准的包。</p>
<h2 id="ssl-root-cas"><a href="#ssl-root-cas" class="headerlink" title="ssl-root-cas"></a>ssl-root-cas</h2><p>当我们在处理自定义的或过期的证书遇到问题时，<code>ssl-root-cas</code>能够帮助我们。当许可证不可用时，它也很有帮助。</p>
<p>归结起来，大部分时间会用到下面的命令。这个<code>inject</code>方法修改<code>https.globalAgent.options.ca</code> 去包含一系列的证书。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">require</span>(<span class="string">'ssl-root-cas'</span>)<span class="selector-class">.inject</span>();</span><br></pre></td></tr></table></figure>
<p>但是，有时也可能需要增加本地自定义的证书。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">require</span>(<span class="string">'ssl-root-cas'</span>)<span class="selector-class">.addFile</span>(<span class="string">'my-cert.crt'</span>);</span><br></pre></td></tr></table></figure>
<p>从 <code>ssl-root-cas</code> 模块返回的这个对象是可串的，因此能够用来增加多个文件或注入多个标准文件在一次调用中。</p>
<h2 id="https"><a href="#https" class="headerlink" title="https"></a>https</h2><p>类似于<code>http</code>,我们可以使用<code>https</code>. 这个主要的区别是如果我们需要发布我们的服务器，我们需要提供一个key。这将会在下一章节讨论。</p>
<p>现在我们仅仅看一下我们怎么创建一个HTTPS请求。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var https = <span class="built_in">require</span>(<span class="string">'https'</span>);</span><br><span class="line"></span><br><span class="line">https.get(<span class="string">'https://www.amazon.com/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(res)</span></span> &#123;</span><br><span class="line">   console.<span class="built_in">log</span>(<span class="string">'statusCode: '</span>, res.statusCode);</span><br><span class="line"></span><br><span class="line">   res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span></span> &#123;</span><br><span class="line">      process.<span class="built_in">stdout</span>.<span class="built_in">write</span>(d);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>基本上，<code>https</code>提供和<code>http</code>相同的功能。但是在最上层增加了SSL/TLS层。API大部分是相同的。</p>
<h2 id="tls"><a href="#tls" class="headerlink" title="tls"></a>tls</h2><p><code>tls</code>模块需要<code>openssl</code>工具包，下一章节将会讨论<code>openssl</code>工具包。这个模块为加密的流传输提供了SSL/TLS。本质上，<code>https</code>也使用了<code>tls</code>。所以，使用<code>tls</code>API时感觉会和<code>http</code>模块的方法相关就不是啥惊奇的事了。</p>
<p>下面简单的代码创建了一个在8000端口监听连接的服务器，进来的连接讲接收一个加密后的数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tls = <span class="built_in">require</span>(<span class="string">'tls'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">   key  : fs.readFileSync(<span class="string">'private.key'</span>),</span><br><span class="line">   cert : fs.readFileSync(<span class="string">'public.cert'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = tls.createServer(options, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">   res.write(<span class="string">'Hello World!'</span>);</span><br><span class="line">   res.pipe(res);</span><br><span class="line">&#125;).listen(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure>
<p>类似的，我们也可以连接这样一个服务器。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tls = <span class="built_in">require</span>(<span class="string">'tls'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">   key  : fs.readFileSync(<span class="string">'private.key'</span>),</span><br><span class="line">   cert : fs.readFileSync(<span class="string">'public.cert'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> client = tls.connect(<span class="number">8000</span>, options, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(client.authorized ? <span class="string">'Authorized'</span> : <span class="string">'Not authorized'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">client.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">   client.end();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>现在，我们应该看一下怎样生成我们自己的key和证书文件。</p>
<h1 id="Generating-Certificates"><a href="#Generating-Certificates" class="headerlink" title="Generating Certificates"></a>Generating Certificates</h1><p>从技术的角度上来看，证书并不是强制的。不过，由于网络的开放性，如果不增加证书，中间人攻击就会变得太平常。因此，一个被可信赖证书认证（CA）的证书是按需求而定的。CA确保了证书的持有者就是这个证书的创建者。</p>
<p>下面，我们会使用<code>openssl</code>工具。这个程序将会给我们用RSA加密生成私有Key的能力。我们也能够发起一个证书签名的请求（CSR）。更进一步的，这个OpenSSL项目的核心库还能生成自签名的证书。这些证书可以用来做测试，它们不应该公开使用。</p>
<p>第一步是创建一个私有的Key。作为一个例子，我们可以使用下面的命令，生成一个叫server.enc.key的文件。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -des3 -out server<span class="selector-class">.enc</span><span class="selector-class">.key</span> <span class="number">1024</span></span><br></pre></td></tr></table></figure>
<p>这个生成的RSA Key是一个1024字节的用三倍DES加密的key。这个文件是人类可读的。作为一个轻量的变形，我们也可以省略掉<code>-des3</code>选项，并且改变加密的强度，比如<code>2048</code>。虽然在这个例子中我们使用了1024字节的key，但是对于真是的Key，我们应该最少使用2048字节的长度。</p>
<p>一旦我们拥有一个生成的Key，我们需要发起一个证书签名的请求。一个证书可以用如下的命令生成：</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -<span class="keyword">new</span> -key <span class="keyword">server</span>.enc.key -out <span class="keyword">server</span>.csr</span><br></pre></td></tr></table></figure>
<p>生成的CSR存在于server.csr文件中。我们需要对这个文件进行自签名。</p>
<p>到这时，当使用server.enc.key文件中的key时，我们需要输入一个密码。由于我们仅在内部使用这个证书，所以我们可以移除密码保护。移除3倍的DES加密用下面的命令。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa -<span class="keyword">in</span> server<span class="selector-class">.enc</span><span class="selector-class">.key</span> -out server.key</span><br></pre></td></tr></table></figure>
<p>现在这个原始加密的server.enc.key文件被转换成非加密的文件server.key。</p>
<p>最后，我们要对这个证书进行自签名。自签名的证书将会在浏览器中生成一个错误。这是因为这个自签名的证书的权威机构是未知的，因此不被信任。为了生成一个临时的证书server.crt，我们需要发送下面的命令。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days <span class="number">365</span> -<span class="keyword">in</span> server<span class="selector-class">.csr</span> -signkey server<span class="selector-class">.key</span> -out server.crt</span><br></pre></td></tr></table></figure>
<p>这个证书将会在发出这个命令的365天内过期。</p>
<h1 id="Integration-with-Express"><a href="#Integration-with-Express" class="headerlink" title="Integration with Express"></a>Integration with Express</h1><p>使用HTTPS代替HTTP是可能的也是被期望的。我们将开始使用Express编写一个小的Node.js应用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   res.send(<span class="string">'Hello World!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.createServer(app).listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'Started!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>启动HTTPS我们需要做啥更改呢？显然，我们需要导入一个不同的包。最后我们也需要提供正确的Key／证书。所有文件的内容需要被展现，它们被传递到<code>https</code>包的<code>createServer</code>方法。</p>
<p>让我们用SSL/TLS重写我们的Express例子:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)();</span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">   key  : fs.readFileSync(<span class="string">'server.key'</span>),</span><br><span class="line">   cert : fs.readFileSync(<span class="string">'server.crt'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   res.send(<span class="string">'Hello World!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">https.createServer(options, app).listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'Started!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>就是如此简单！在上面的例子中，我们假设key和证书都位于工作目录中。这仍然有很大的提升空间。一个可能性是放这段代码到创建server的module中。这个module将会根据选择不同的协议来选择正确的包。另外，这个端口，key和证书应该驱逐到一个<code>settongs</code>对象中。</p>
<p>一个简单的实现可能看起来如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setup</span> (<span class="params">ssl</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (ssl &amp;&amp; ssl.active) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">         key  : fs.readFileSync(ssl.key),</span><br><span class="line">         cert : fs.readFileSync(ssl.certificate)</span><br><span class="line">      &#125;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">start</span> (<span class="params">app, options</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (options)</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">'https'</span>).createServer(options, app);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">'http'</span>).createServer(app);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">   create: <span class="function"><span class="keyword">function</span> (<span class="params">settings, app, cb</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> options = setup(settings.ssl);</span><br><span class="line">      <span class="keyword">return</span> start(app, options).listen(settings.port, cb);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>关键的地方是<code>settings</code>中的<code>ssl</code>对象，如果这个对象存在并且有个叫<code>active</code>的参数设置为true，那么我们将会用提供的Key／证书启动SSL／TLS。</p>
<h1 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h1><p>在2015年，没有理由再去忽视HTTPS了。未来的方向是清晰可见的——到处都是HTTPS！在Node.js中， 我们有很多选择去管理SSL／TLS。我们可以发布我们HTTPS的网站，我们可以对加密的网站发起请求，我们也能授权哪怕不被信任的证书。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/09/15/Helpful-JS-Resources-Recommanded-by-Code-School/" itemprop="url">
                  Helpful JS Resources Recommanded by Code School
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-09-15T20:44:39+08:00" content="Sep 15 2015">
              Sep 15 2015
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Javascript/" itemprop="url" rel="index">
                    <span itemprop="name">Javascript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>完成了code school中的JS课程部分，纪录一些老师推荐的网站</p>
<ul>
<li><a href="http://jstherightway.org/" target="_blank" rel="noopener">JavaScript: The Right Way</a></li>
<li><a href="http://javascript.crockford.com/code.html" target="_blank" rel="noopener">Code Conventions for JavaScript</a></li>
<li><a href="http://flippinawesome.org/2013/12/23/45-useful-javascript-tips-tricks-and-best-practices/" target="_blank" rel="noopener">45 Useful JavaScript Tips and Tricks</a></li>
<li><a href="http://www.thinkful.com/learn/javascript-best-practices-1/" target="_blank" rel="noopener">Thinkful: Best Practices 1 and 2</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/09/14/Cocoa-Autolayout-content-hugging-vs-content-compression-resistance-priority/" itemprop="url">
                  Cocoa Autolayout: Content Hugging vs Content Compression Resistance Priority
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-09-14T22:11:15+08:00" content="Sep 14 2015">
              Sep 14 2015
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###Intrinsic Content Size</p>
<p>The intrinsic content size is the size a view prefers to have for a specific content it displays. For example, UILabel has a preferred height based on the font, and a preferred width based on the font and the text it displays. A UIProgressView only has a preferred height based on its artwork, but no preferred width. A plain UIView has neither a preferred width nor a preferred height.</p>
<p>###Compression Resistance and Content Hugging</p>
<p>Each view has content compression resistance priorities and content hugging priorities assigned for both dimensions. These properties only take effect for views which define an intrinsic content size, otherwise there is no content size defined that could resist compression or be hugged.</p>
<p>Behind the scenes, the intrinsic content size and these priority values get translated into constraints. For a label with an intrinsic content size of { 100, 30 }, horizontal/vertical compression resistance priority of 750, and horizontal/vertical content hugging priority of 250, four constraints will be generated:</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">H</span>:[label(&lt;=<span class="number">100</span><span class="variable">@250</span>)] </span><br><span class="line"><span class="attribute">H</span>:[label(&gt;=<span class="number">100</span><span class="variable">@750</span>)]</span><br><span class="line"><span class="attribute">V</span>:[label(&lt;=<span class="number">30</span><span class="variable">@250</span>)]</span><br><span class="line"><span class="attribute">V</span>:[label(&gt;=<span class="number">30</span><span class="variable">@750</span>)]</span><br></pre></td></tr></table></figure>
<p>If you’re not familiar with the visual format language for the constraints used above, you can read up about it in Apple’s documentation. Keeping in mind that these additional constraints are generated implicitly helps to understand Auto Layout’s behavior and to make better sense of its error messages.</p>
<hr>
<p>Quick summary of the concepts:</p>
<ul>
<li>Hugging =&gt; content does not want to grow<br>Compression </li>
<li>Resistance =&gt; content does not want to shrink</li>
</ul>
<p>and an example:</p>
<p>Say you’ve got button like this:</p>
<p><code>[       Click Me      ]</code></p>
<p>and you’ve pinned the edges to a larger superview with priority 500.</p>
<p>Then, if Hugging priority &gt; 500 it’ll look like this:</p>
<p><code>[Click Me]</code></p>
<p>If Hugging priority &lt; 500 it’ll look like this:</p>
<p><code>[       Click Me      ]</code></p>
<p>If superview now shrinks then, if the Compression Resistance priority &gt; 500, it’ll look like this</p>
<p><code>[Click Me]</code></p>
<p>Else if Compression Resistance priority &lt; 500, it could look like this:</p>
<p><code>[Cli..]</code></p>
<p>If it doesn’t work like this then you’ve probably got some other constraints going on that are messing up your good work!</p>
<p>E.g. you could have it pinned to the superview with priority 1000. Or you could have a width priority. If so, this can be helpful:</p>
<p>Editor &gt; Size to Fit Content</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/08/09/切图攻略/" itemprop="url">
                  切图攻略
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-08-09T18:22:44+08:00" content="Aug 9 2015">
              Aug 9 2015
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/PS/" itemprop="url" rel="index">
                    <span itemprop="name">PS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <img src="/2015/08/09/切图攻略/1.pic_hd.jpg">
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/08/09/Android无线调试/" itemprop="url">
                  Android无线调试
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-08-09T16:56:41+08:00" content="Aug 9 2015">
              Aug 9 2015
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <img src="/2015/08/09/Android无线调试/QQ20150809-2@2x.png">
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/25/Dropbox-API-使用时遇到的问题/" itemprop="url">
                  Dropbox API 使用时遇到的问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-07-25T19:37:19+08:00" content="Jul 25 2015">
              Jul 25 2015
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近的项目需要整合Dropbox。需求是，拿到token和userids传到服务器。</p>
<p>记得上一次做OAuth2.0是2011年，那时候刚刚到第一个公司，新浪微博那时貌似还是OAuth1.0授权，而且文档不全，要靠试错来确定参数。那时没有集成好的类库可调用，自己也是第一次接触，用了一个星期时间把新浪微博，腾讯微博，开心网，人人网，qq空间都集成了项目内，慢慢的对OAuth2.0有些了解。</p>
<p>这里面主要用到两块知识，一块就是OAuth2.0的流程，另一个就是授权后如何跳转到自己的app内。</p>
<p>今天重做时，这两块各遇到一个问题，下面说说这两个问题。</p>
<p>###OAuth2.0<br>这个发送授权请求时，有一个参数是response_type，它的值可取<code>token</code>和<code>code</code>,我看例子请求用的是<code>code</code>，我也用<code>code</code>，结果在Safira内授权后死活都不忘自己app内跳转。后来在停留的网页上的一行小字发现了秘密。</p>
<img src="/2015/07/25/Dropbox-API-使用时遇到的问题/QQ20150725-1@2x.png">
<p>于是改成<code>token</code>试一下就可以了。然后仔细看文档才发现，原来它这个流程分为成两个:</p>
<blockquote>
<p>####Code flow</p>
</blockquote>
<blockquote>
<p>These parameters are passed in the query string (after the ? in the URL):</p>
</blockquote>
<blockquote>
<blockquote>
<p><strong>code</strong> The authorization code, which can be used to attain a bearer token by calling /oauth2/token.</p>
<p><strong>state</strong> The state content, if any, originally passed to /oauth2/authorize.</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p><strong>Sample response</strong></p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
</blockquote>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[REDIRECT_URI]?code=ABCDEFG&amp;<span class="keyword">state</span>=[STATE]</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>####Token flow</p>
</blockquote>
<blockquote>
<p>These parameters are passed in the URL fragment (after the # in the URL):</p>
</blockquote>
<blockquote>
<blockquote>
<p><strong>access_token</strong> A token which can be used to make calls to the Dropbox API.</p>
<p><strong>token_type</strong> The type of token, which will always be bearer.</p>
<p><strong>uid</strong> The Dropbox user ID of the authorized user.</p>
<p><strong>state</strong> The state content, if any, originally passed to /oauth2/authorize.</p>
<p><strong>Sample response</strong></p>
</blockquote>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[REDIRECT_URI]</span>#access_token=ABCDEFG&amp;token_type=bearer&amp;uid=<span class="number">12345</span>&amp;state=<span class="string">[STATE]</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Custome-URL-Schemes"><a href="#Custome-URL-Schemes" class="headerlink" title="Custome URL Schemes"></a>Custome URL Schemes</h3><p>我在<code>URL Schemes</code>框框内填了一个xxx://xxx的格式，其实只要填xxx就可以了。</p>
<img src="/2015/07/25/Dropbox-API-使用时遇到的问题/scheme.png">
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/19/在我写我的第一个Android-app时，我希望我能知道的6件事/" itemprop="url">
                  在我写我的第一个Android App时，我希望我能知道的6件事
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-07-19T20:04:21+08:00" content="Jul 19 2015">
              Jul 19 2015
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我的第一个app是糟糕的。实际上，它太糟糕了，所以我把它从商店中移除，我甚至不再因我把它列在我的简历之中而烦恼。如果我在写它之前，知道一些有关Android开发的事，那个app就不会那么糟糕。</p>
<p>当你写你的第一个Android app时，这有一个列表你需要记着。这些经验教训是我在写第一个app源码时，犯下的真实的错误。我将会在后面展示这些错误。记住这些事情能帮助你写一个让你感到有点自豪的app。</p>
<p>当然，如果你作为一个Android开发的学生正在做正确的工作，无论如何，不久后你都有可能恨你写的app，正如@codestandards所说，如果你一年前码的代码并不能让你感觉到不适，那你有可能没怎么学习。</p>
<p>如果你是一个有经验的Java开发者， 第1，2和第5条可能并不能让你感兴趣。另外的第3，4条可能展示你一些很酷的但你可能还不知道的东西。</p>
<p>###对<code>Contexts</code>不要有静态引用<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">LocationManagingActivity</span> <span class="title">implements</span> <span class="title">ActionBar</span>.<span class="title">OnNavigationListener</span>,</span></span><br><span class="line"><span class="class">        <span class="title">GooglePlayServicesClient</span>.<span class="title">ConnectionCallbacks</span>,</span></span><br><span class="line"><span class="class">        <span class="title">GooglePlayServicesClient</span>.<span class="title">OnConnectionFailedListener</span> </span>&#123;</span><br><span class="line">            </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> static <span class="type">MeTrackerStore</span> mMeTrackerStore; </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        </span><br><span class="line">        mMeTrackerStore = <span class="keyword">new</span> <span class="type">MeTrackerStore</span>(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这可能看起来对任何人来说，都是一个不可能犯的错误。但并非这样，我就犯过。我也看到其他人犯过这样的错误，并且我也看到很多人并不能在第一时间指出为什么这是一个错误。不要这样做。它是一个<code>noob move</code></p>
<p>如果当这个<code>Activity</code>传递到它的构造函数里，<code>MeTrackerStore</code>持有这个<code>Activity</code>的引用，那这个<code>Activity</code>将仍然不会被回收（除非这个静态变量被重新赋值给另一个<code>Activity</code>）。这是因为<code>mMeTrackerStore</code>是静态的，静态变量的内存是不会被回收的，直到程序里正在运行的进程停止。如果你发现自己尝试这么做，那么你的代码可能有一些严重的错误。寻找帮助的话，可以看看Google’s Udacity里的课程<a href="https://www.udacity.com/course/android-development-for-beginners--ud837" target="_blank" rel="noopener"> “Android Development for Beginners”</a></p>
<p>注意：技术上讲，你可以hold一个对<code>Context</code>的静态引用，但不会引起内存泄漏，但我不会推荐你这么做。</p>
<p>###当心对那些你无法控制它的生命周期的对象进行隐式引用</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">DefineGeofenceFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line">    public <span class="class"><span class="keyword">class</span> <span class="title">GetLatAndLongAndUpdateMapCameraAsyncTask</span> <span class="keyword">extends</span> <span class="title">AsyncTask&lt;String</span>, <span class="title">Void</span>, <span class="title">LatLng&gt;</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="type">LatLng</span> doInBackground(<span class="type">String</span>... params) &#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//Here we make the http request for the place search suggestions</span></span><br><span class="line">                httpResponse = httpClient.execute(httpPost);</span><br><span class="line">                <span class="type">HttpEntity</span> entity = httpResponse.getEntity();</span><br><span class="line">                inputStream = entity.getContent();</span><br><span class="line">                <span class="comment">//..</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码有很多问题，但我将关注其中的一个。在Java中，非静态的内部类对包含它的类对象有一个隐式的引用。</p>
<p>在这个例子中，任何<code>GetLatAndLongAndUpdateMapCameraAsyncTask</code>对象都将有个<code>DefineGeofenceFragment</code>对象的引用。匿名类也是如此：它会对包含它的类对象有个隐式的引用。</p>
<p>这个<code>GetLatAndLongAndUpdateMapCameraAsyncTask</code>对象对<code>Fragment</code>对象有个隐式的的引用，一个我们无法控制它生命周期的对象。Android SDK负责适当的创建和销毁<code>Fragment</code>对象，如果因为<code>GetLatAndLongAndUpdateMapCameraAsyncTask</code>对象正在执行所以不能被回收的话，那它持有对象也无法被回收。</p>
<p>这里有一个很棒的Google IO 视频<a href="https://www.youtube.com/watch?v=_CruQY55HOk" target="_blank" rel="noopener">解释为什么这种事会发生</a></p>
<p>###让Android Studio为你工作<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ViewPager <span class="title">getmViewPager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mViewPager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个片段是我使用”Generate Getter”代码补全时，Android Studio为我生成的，这个getter方法对这个实例变量保持了’m’前缀。这并不理想。</p>
<p>(另外，你一定想知道为毛实例变量神明的时候要带个’m’前缀：这个’m’常常被约定作为实例变量的前缀。它代表了’member’。)</p>
<p>不论你是否认为’m’作为你实例变量的前缀是一个好主意，这里有一个经验：Android Studio可以帮你按照你养成的习惯去编写代码。比如说，你可以使用Android Studio中的代码风格框去让Android Studio自动的加上’m’到你的实例变量并且自动移除’m’当它生成getters，setters，和构造参数时。</p>
<img src="/2015/07/19/在我写我的第一个Android-app时，我希望我能知道的6件事/Screen-Shot-2015-07-09-at-4.16.13-PM.png">
<p>Android Studio可以做很多事情，学习<a href="http://www.developerphil.com/android-studio-tips-of-the-day-roundup-1/" target="_blank" rel="noopener">快捷键</a>和<a href="https://www.jetbrains.com/idea/help/live-templates.html" target="_blank" rel="noopener">活动模版</a>会是一个好的开始。</p>
<p>###方法应该只做一件事</p>
<p>有一个方法我写超过了1000行。这样的方法很难读懂，修改和重用。试着写仅仅做一件事的方法。典型的，这意味着你应该怀疑那些你写超过20行的代码。这里你可以招募Android Studio去帮助你指出有问题的方法:</p>
<img src="/2015/07/19/在我写我的第一个Android-app时，我希望我能知道的6件事/Screen-Shot-2015-07-09-at-4.25.00-PM.png">
<p>###向那些比你更聪明，更有经验的人学习</p>
<p>这好像挺起来不重要，但是这是我写第一个app时犯下的错误。</p>
<p>当你正在写程序时，你将会犯错。其他的人已经犯过这样的错误了。向其他人学习。如果你重复那些可以避免的错误，那你就是在浪费时间。</p>
<p>读<a href="http://www.amazon.com/The-Pragmatic-Programmer-Journeyman-Master/dp/020161622X" target="_blank" rel="noopener">Pragmatic Programmer</a>. 然后读<a href="http://www.amazon.com/Effective-Java-Edition-Joshua-Bloch/dp/0321356683" target="_blank" rel="noopener">Effective Java</a>.这两本书会帮助你避免犯一些常见的错误。当你读完这两本书后，保持向聪明的人学习。</p>
<p>###使用库<br>当你写一个app，你可能会遇到那鞋前人已经解决了的问题。而且，大量的解决办法都是开放的作为资源库。 好好利用他们。</p>
<p>在我的第一个app中，我写的功能已经被其他库所提供了，它们中的一些库来自于标准的java中的一部分。另一些则是像<code>Retrofit</code>和<code>Picasso</code>这样的库。如果你不确定你要应该用什么库，你能做3件事：</p>
<ol>
<li>听<a href="http://fragmentedpodcast.com/episodes/9/" target="_blank" rel="noopener">Google IO Fragmented podcast episode</a></li>
<li>订阅<a href="http://androidweekly.net/" target="_blank" rel="noopener">Android Weekly</a></li>
<li>寻找解决类似问题的开源应用。你可能发现它们用了第三发的库(third-party library)或者用了你并没有在意的标准的java库。</li>
</ol>
<p>###总结<br>写一个好的Android app是非常难的。不要因为重复我的错误让它变的更加艰难。</p>
<p>翻译自:<a href="http://www.philosophicalhacker.com/2015/07/09/6-things-i-wish-i-knew-before-i-wrote-my-first-android-app/" target="_blank" rel="noopener">6 THINGS I WISH I KNEW BEFORE I WROTE MY FIRST ANDROID APP</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/18/Some-Tips-About-NSURLSession/" itemprop="url">
                  Some Tips  About NSURLSession
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-07-18T20:48:02+08:00" content="Jul 18 2015">
              Jul 18 2015
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>后台传输时，需要保证队列里有多于一个任务，否则程序仍然会挂起。</li>
<li>后台传输服务仅支持<code>NSURLSessionUploadTask</code>,<code>NSURLSessionDownloadTask</code>,并不支持<code>NSURLSessionTask</code>。</li>
<li>后台上传时，只能使用<code>uploadTaskWithRequest:fromFile:</code>这个方法。如果NSURLSession对象由<code>backgroundSessionConfiguration</code>这个参数创建，这个方法<code>uploadTaskWithRequest:fromData:</code>不会工作。参见<a href="http://stackoverflow.com/questions/19985353/nsurlsession-uploading-assets-with-background-transfer?rq=1" target="_blank" rel="noopener">这里</a></li>
<li>In iOS, when a background transfer completes or requires credentials, if your app is no longer running, iOS automatically relaunches your app in the background and calls the <code>application:handleEventsForBackgroundURLSession:completionHandler:</code> method on your app’s <code>UIApplicationDelegate</code> object. This call provides the identifier of the session that caused your app to be launched. Your app should store that completion handler, create a background configuration object with the same identifier, and create a session with that configuration object. The new session is automatically reassociated with ongoing background activity. Later, when the session finishes the last background download task, it sends the session delegate a <code>URLSessionDidFinishEventsForBackgroundURLSession:</code> message. Your session delegate should then call the stored completion handler.</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/18/一张图告诉你怎么选择后台运行技术/" itemprop="url">
                  一张图告诉你怎么选择后台运行技术
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-07-18T15:33:26+08:00" content="Jul 18 2015">
              Jul 18 2015
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <img src="/2015/07/18/一张图告诉你怎么选择后台运行技术/image.png">
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/08/iOS8-New-Features-Photos-Framework/" itemprop="url">
                  iOS8 New Features: Photos Framework
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-07-08T21:09:08+08:00" content="Jul 8 2015">
              Jul 8 2015
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS8/" itemprop="url" rel="index">
                    <span itemprop="name">iOS8</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近有个项目要请求系统相册，就先把iOS8中的新特性<code>Photos Framework</code>研究一下，参考 iOS_8_by_Tutorials。</p>
<p>###模型对象<br><code>Photos Framework</code> 中的模型对象是继承于一个基类<code>PHObject</code>，它们是轻量级的对象，仅仅包含了一些原数据的描叙，但并不包含其内容。这些具体的模型对象是：</p>
<ol>
<li><p><code>PHAsset</code>：表示一个单独的asset，它可能是一张图片或者视频。它包含了元数据比如是否是喜爱的，是否是隐藏的和媒介的类型。</p>
</li>
<li><p><code>PHAssetCollection</code>： 表示一组有序的asset的列表。</p>
</li>
<li><p><code>PHCollectionList</code>: 表示一组有序的<code>PHAssetCollection</code>的列表，或者<code>PHCollectionList</code>的列表。</p>
</li>
</ol>
<h3 id="获取-Fetching"><a href="#获取-Fetching" class="headerlink" title="获取(Fetching)"></a>获取(Fetching)</h3><p>获取(Fetching)在<code>Photos framework</code>中是一个关键的特性，你可以获取任何的模型对象通过使用它所对应的类方法。另外当你获取的时候，你也可以使用<code>PHFetchOptions</code>选项。<code>PHFetchOptions</code>允许你指定哪些是你想要的，获取的结果应该如何排列，还有当结果发生改变时，Photos应该怎样提醒你。这些可以通过设置<code>PHFetchOptions</code>对象中的<code>predicate</code>，<code>sortDescriptors</code>,<code>includeAllBurstAssets</code>,<code>includeHiddenAssets</code>和<code>wantsIncrementalChangeDetails</code>属性，然后把它传给获取(Fetch)方法得到。</p>
<p>获取(Fetching)会一直返回一个<code>PHFetchResult</code>对象，一个<code>PHFetchResult</code>对象是一组有序的模型对象集合,它有一个接口和<code>NSArray</code>类似。这里最大的不同应该能让你站起来欢呼——<code>PHFetchResult</code>能替你管理内存并且实现对象的懒加载。这意味着获取和遍历上千的asset,理论上讲，不会比遍历几百个asset消耗更多的内存。十分惊奇。</p>
<p>记住，模型对象并不hold任何的内容，如果你想retrieve某个asset collection中的所有assets， 你不的不fetch他们。类似的，如果你想去展示和这些asset绑定的图片，你不的不加载它们。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)fetchCollections &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//获取喜爱的asset集合</span></span><br><span class="line">  self.userFavorites = [PHAssetCollection <span class="string">fetchAssetCollectionsWithType:</span>PHAssetCollectionTypeSmartAlbum <span class="string">subtype:</span>PHAssetCollectionSubtypeSmartAlbumFavorites <span class="string">options:</span>nil];</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//获取相册的集合（即是asset的集合的集合）</span></span><br><span class="line">  self.userAlbums = [PHCollectionList <span class="string">fetchTopLevelUserCollectionsWithOptions:</span>nil];</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>###加载内容<br>当你想展示属于一个asset的图片或视频内容的话，你需要通过一个<code>PHImageManager</code>的实例去加载它。这个默认的图片加载器是异步工作的，处理对asset的加载，缓存和调整。它的一个叫<code>PHCachingImageManager</code>的子类能预缓存asset的内容到内存中，并确保当你需要用到它们的时候，它们是可用的。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1</span>let reuseCount = ++cell<span class="selector-class">.reuseCount</span>let asset = currentAssetAtIndex(indexPath.item)<span class="comment">// 2</span>let options = PHImageRequestOptions() options<span class="selector-class">.networkAccessAllowed</span> = true<span class="comment">// 3 PHImageManager.defaultManager().requestImageForAsset(asset,</span>targetSize: assetThumbnailSize, contentMode: <span class="selector-class">.AspectFill</span>, options: options) &#123; result, info <span class="keyword">in</span><span class="keyword">if</span> reuseCount == cell<span class="selector-class">.reuseCount</span> &#123; cell<span class="selector-class">.imageView</span><span class="selector-class">.image</span> = result&#125; &#125;</span><br></pre></td></tr></table></figure>
<p>注意这里的<code>requestImageForAsset</code>方法，这个方法可能会被回调多次。<code>Photos Framework</code>提供了可以立即使用的低分辨率的asset版本，随后也可能提供一个高质量的asset版本。</p>
<p>###预加载<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)updateCache &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">CGFloat</span> currentFrameCenter = <span class="built_in">CGRectGetMidY</span>(<span class="keyword">self</span>.collectionView.bounds);</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,<span class="built_in">NSStringFromCGRect</span>(<span class="keyword">self</span>.collectionView.bounds) );</span><br><span class="line">  <span class="keyword">if</span> (fabs(currentFrameCenter - <span class="keyword">self</span>.lastCacheFrameCenter) &lt; <span class="built_in">CGRectGetHeight</span>(<span class="keyword">self</span>.collectionView.bounds)/<span class="number">3</span>) &#123;</span><br><span class="line">    <span class="comment">// Haven't scrolled far enough yet</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">self</span>.lastCacheFrameCenter = currentFrameCenter;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">NSInteger</span> numOffscreenAssetsToCache = <span class="number">60</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">NSArray</span> * visibleIndexes = [<span class="keyword">self</span>.collectionView.indexPathsForVisibleItems sortedArrayUsingSelector:<span class="keyword">@selector</span>(compare:)];</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (!visibleIndexes.count) &#123;</span><br><span class="line">    [<span class="keyword">self</span>.imageManager stopCachingImagesForAllAssets];</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">NSInteger</span> firstItemToCache = ((<span class="built_in">NSIndexPath</span> *)visibleIndexes[<span class="number">0</span>]).item - numOffscreenAssetsToCache/<span class="number">2</span>;</span><br><span class="line">  firstItemToCache = MAX(firstItemToCache, <span class="number">0</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">NSInteger</span> lastItemToCache = ((<span class="built_in">NSIndexPath</span> *)[visibleIndexes lastObject]).item + numOffscreenAssetsToCache/<span class="number">2</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">self</span>.assetsFetchResults) &#123;</span><br><span class="line">    lastItemToCache = MIN(lastItemToCache, <span class="keyword">self</span>.assetsFetchResults.count - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    lastItemToCache = MIN(lastItemToCache, <span class="keyword">self</span>.selectedAssets.count - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">NSMutableArray</span> * indexesToStopCaching = [[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">  <span class="built_in">NSMutableArray</span> * indexesToStartCaching = [[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Stop caching items we scrolled past</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">NSIndexPath</span> * index <span class="keyword">in</span> <span class="keyword">self</span>.cachingIndexes) &#123;</span><br><span class="line">    <span class="keyword">if</span> (index.item &lt; firstItemToCache || index.item &gt; lastItemToCache) &#123;</span><br><span class="line">      [indexesToStopCaching addObject:index];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="keyword">self</span>.cachingIndexes removeObjectsInArray:indexesToStopCaching];</span><br><span class="line">  </span><br><span class="line">  [<span class="keyword">self</span>.imageManager stopCachingImagesForAssets:[<span class="keyword">self</span> assetsAtIndexPaths:indexesToStopCaching]</span><br><span class="line">                                     targetSize:<span class="keyword">self</span>.assetThumbnailSize</span><br><span class="line">                                    contentMode:PHImageContentModeAspectFill</span><br><span class="line">                                        options:<span class="literal">nil</span>];</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Start caching new items in range</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = firstItemToCache; i &lt; lastItemToCache; i++) &#123;</span><br><span class="line">    <span class="built_in">NSIndexPath</span> * index = [<span class="built_in">NSIndexPath</span> indexPathForItem:i inSection:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.cachingIndexes containsObject:index]) &#123;</span><br><span class="line">      [indexesToStartCaching addObject:index];</span><br><span class="line">      [<span class="keyword">self</span>.cachingIndexes addObject:index];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  [<span class="keyword">self</span>.imageManager startCachingImagesForAssets:[<span class="keyword">self</span> assetsAtIndexPaths:indexesToStartCaching]</span><br><span class="line">                                      targetSize:<span class="keyword">self</span>.assetThumbnailSize</span><br><span class="line">                                     contentMode:PHImageContentModeAspectFill</span><br><span class="line">                                         options:<span class="literal">nil</span>];</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="Changwei">
          <p class="site-author-name" itemprop="name">Changwei</p>
          <p class="site-description motion-element" itemprop="description">I develop iOS/Android apps with Swift/Kotlin language.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">73</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">32</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/cwtututu" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/thankforyou" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://cn.linkedin.com/pub/vale-tu/71/527/3a1/" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Linkedin
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.upwork.com/o/profiles/users/_~01eeefc89751549361/" target="_blank" title="Upwork">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Upwork
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.peopleperhour.com/freelancer/changwei/tu/ios-android-developer-parse-layer/986083" target="_blank" title="peopleperhour">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  peopleperhour
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons">
            </a>
          </div>
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Changwei</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
